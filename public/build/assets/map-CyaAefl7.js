import{G as pe,M as ge,a as de}from"./GraticuleSeries-DNsOzU_K.js";import{p as yt,r as B,j as tt,o as ct,k as b,e as _,d as w,f as z,h as m,c as ft,q as W,s as T,t as mt,u as _t,v as bt,w as wt,x as N,y as Dt}from"./MapPolygonSeries-Tlh8Nl7U.js";import{z as ve,M as ye,B as me,a as _e,m as be,g as we,H as De,G as Pe,F as Me,D as Ce,C as Ee,E as Ie}from"./MapPolygonSeries-Tlh8Nl7U.js";import{M as ht}from"./MapPointSeries-C2pPfjWL.js";import{aF as Pt,ai as Mt,C as et,al as Ct,L as Et,aG as It}from"./SerialChart-CAnqEg8j.js";import{e as v,d as rt,j as U,r as jt}from"./Theme-Dgo0XspA.js";import{Z as Re}from"./ZoomControl-D3aVP6vn.js";import"./app-CATfDaKV.js";import"./tslib.es6-CmEaCU22.js";import"./ZoomTools-CCR8UINi.js";import"./Button-Dxks9qV6.js";function Rt(r){var n=0,t=ct/3,e=yt(r),i=e(n,t);return i.parallels=function(s){return arguments.length?e(n=s[0]*B,t=s[1]*B):[n*tt,t*tt]},i}function kt(r){var n=w(r);function t(e,i){return[e*n,_(i)/n]}return t.invert=function(e,i){return[e/n,b(i*n)]},t}function At(r,n){var t=_(r),e=(t+_(n))/2;if(z(e)<m)return kt(r);var i=1+t*(2*e-t),s=T(i)/e;function a(l,u){var o=T(i-2*e*_(u))/e;return[o*_(l*=e),s-o*w(l)]}return a.invert=function(l,u){var o=s-u,f=ft(l,z(o))*W(o);return o*e<0&&(f-=ct*W(l)*W(o)),[f/e,b((i-(l*l+o*o)*e*e)/(2*e))]},a}function V(){return Rt(At).scale(155.424).center([0,33.6442])}function qt(){return V().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Lt(r){var n=r.length;return{point:function(t,e){for(var i=-1;++i<n;)r[i].point(t,e)},sphere:function(){for(var t=-1;++t<n;)r[t].sphere()},lineStart:function(){for(var t=-1;++t<n;)r[t].lineStart()},lineEnd:function(){for(var t=-1;++t<n;)r[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<n;)r[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<n;)r[t].polygonEnd()}}}function ae(){var r,n,t=qt(),e,i=V().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,a=V().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l,u,o={point:function(c,h){u=[c,h]}};function f(c){var h=c[0],g=c[1];return u=null,e.point(h,g),u||(s.point(h,g),u)||(l.point(h,g),u)}f.invert=function(c){var h=t.scale(),g=t.translate(),p=(c[0]-g[0])/h,d=(c[1]-g[1])/h;return(d>=.12&&d<.234&&p>=-.425&&p<-.214?i:d>=.166&&d<.234&&p>=-.214&&p<-.115?a:t).invert(c)},f.stream=function(c){return r&&n===c?r:r=Lt([t.stream(n=c),i.stream(c),a.stream(c)])},f.precision=function(c){return arguments.length?(t.precision(c),i.precision(c),a.precision(c),x()):t.precision()},f.scale=function(c){return arguments.length?(t.scale(c),i.scale(c*.35),a.scale(c),f.translate(t.translate())):t.scale()},f.translate=function(c){if(!arguments.length)return t.translate();var h=t.scale(),g=+c[0],p=+c[1];return e=t.translate(c).clipExtent([[g-.455*h,p-.238*h],[g+.455*h,p+.238*h]]).stream(o),s=i.translate([g-.307*h,p+.201*h]).clipExtent([[g-.425*h+m,p+.12*h+m],[g-.214*h-m,p+.234*h-m]]).stream(o),l=a.translate([g-.205*h,p+.212*h]).clipExtent([[g-.214*h+m,p+.166*h+m],[g-.115*h-m,p+.234*h-m]]).stream(o),x()},f.fitExtent=function(c,h){return mt(f,c,h)},f.fitSize=function(c,h){return _t(f,c,h)},f.fitWidth=function(c,h){return bt(f,c,h)},f.fitHeight=function(c,h){return wt(f,c,h)};function x(){return r=n=null,f}return f.scale(1070)}function St(r){return function(n,t){var e=T(n*n+t*t),i=r(e),s=_(i),a=w(i);return[ft(n*s,e*a),b(e&&t*s/e)]}}function $(r,n){return[r,n]}$.invert=$;function ue(){return N($).scale(152.63)}var M=1.340264,C=-.081106,E=893e-6,I=.003796,Z=T(3)/2,Gt=12;function pt(r,n){var t=b(Z*_(n)),e=t*t,i=e*e*e;return[r*w(t)/(Z*(M+3*C*e+i*(7*E+9*I*e))),t*(M+C*e+i*(E+I*e))]}pt.invert=function(r,n){for(var t=n,e=t*t,i=e*e*e,s=0,a,l,u;s<Gt&&(l=t*(M+C*e+i*(E+I*e))-n,u=M+3*C*e+i*(7*E+9*I*e),t-=a=l/u,e=t*t,i=e*e*e,!(z(a)<Dt));++s);return[Z*r*(M+3*C*e+i*(7*E+9*I*e))/w(t),b(_(t)/Z)]};function le(){return N(pt).scale(177.158)}function gt(r,n){var t=n*n,e=t*t;return[r*(.8707-.131979*t+e*(-.013791+e*(.003971*t-.001529*e))),n*(1.007226+t*(.015085+e*(-.044475+.028874*t-.005916*e)))]}gt.invert=function(r,n){var t=n,e=25,i;do{var s=t*t,a=s*s;t-=i=(t*(1.007226+s*(.015085+a*(-.044475+.028874*s-.005916*a)))-n)/(1.007226+s*(.015085*3+a*(-.044475*7+.028874*9*s-.005916*11*a)))}while(z(i)>m&&--e>0);return[r/(.8707+(s=t*t)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),t]};function oe(){return N(gt).scale(175.295)}function dt(r,n){return[w(n)*_(r),_(n)]}dt.invert=St(b);function ce(){return N(dt).scale(249.5).clipAngle(90+m)}function Ot(r){return r==null?null:zt(r)}function zt(r){if(typeof r!="function")throw new Error;return r}function nt(){return 0}function Tt(r){return function(){return r}}const Zt=1664525,Nt=1013904223,it=4294967296;function Ht(){let r=1;return()=>(r=(Zt*r+Nt)%it)/it}function Ft(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function Wt(r,n){let t=r.length,e,i;for(;t;)i=n()*t--|0,e=r[t],r[t]=r[i],r[i]=e;return r}function Ut(r,n){for(var t=0,e=(r=Wt(Array.from(r),n)).length,i=[],s,a;t<e;)s=r[t],a&&xt(a,s)?++t:(a=Yt(i=Xt(i,s)),t=0);return a}function Xt(r,n){var t,e;if(X(n,r))return[n];for(t=0;t<r.length;++t)if(G(n,r[t])&&X(P(r[t],n),r))return[r[t],n];for(t=0;t<r.length-1;++t)for(e=t+1;e<r.length;++e)if(G(P(r[t],r[e]),n)&&G(P(r[t],n),r[e])&&G(P(r[e],n),r[t])&&X(vt(r[t],r[e],n),r))return[r[t],r[e],n];throw new Error}function G(r,n){var t=r.r-n.r,e=n.x-r.x,i=n.y-r.y;return t<0||t*t<e*e+i*i}function xt(r,n){var t=r.r-n.r+Math.max(r.r,n.r,1)*1e-9,e=n.x-r.x,i=n.y-r.y;return t>0&&t*t>e*e+i*i}function X(r,n){for(var t=0;t<n.length;++t)if(!xt(r,n[t]))return!1;return!0}function Yt(r){switch(r.length){case 1:return Vt(r[0]);case 2:return P(r[0],r[1]);case 3:return vt(r[0],r[1],r[2])}}function Vt(r){return{x:r.x,y:r.y,r:r.r}}function P(r,n){var t=r.x,e=r.y,i=r.r,s=n.x,a=n.y,l=n.r,u=s-t,o=a-e,f=l-i,x=Math.sqrt(u*u+o*o);return{x:(t+s+u/x*f)/2,y:(e+a+o/x*f)/2,r:(x+i+l)/2}}function vt(r,n,t){var e=r.x,i=r.y,s=r.r,a=n.x,l=n.y,u=n.r,o=t.x,f=t.y,x=t.r,c=e-a,h=e-o,g=i-l,p=i-f,d=u-s,y=x-s,j=e*e+i*i-s*s,D=j-a*a-l*l+u*u,K=j-o*o-f*f+x*x,R=h*g-c*p,k=(g*K-p*D)/(R*2)-e,A=(p*d-g*y)/R,q=(h*D-c*K)/(R*2)-i,L=(c*y-h*d)/R,H=A*A+L*L-1,S=2*(s+k*A+q*L),Q=k*k+q*q-s*s,F=-(Math.abs(H)>1e-6?(S+Math.sqrt(S*S-4*H*Q))/(2*H):Q/S);return{x:e+k+A*F,y:i+q+L*F,r:F}}function st(r,n,t){var e=r.x-n.x,i,s,a=r.y-n.y,l,u,o=e*e+a*a;o?(s=n.r+t.r,s*=s,u=r.r+t.r,u*=u,s>u?(i=(o+u-s)/(2*o),l=Math.sqrt(Math.max(0,u/o-i*i)),t.x=r.x-i*e-l*a,t.y=r.y-i*a+l*e):(i=(o+s-u)/(2*o),l=Math.sqrt(Math.max(0,s/o-i*i)),t.x=n.x+i*e-l*a,t.y=n.y+i*a+l*e)):(t.x=n.x+t.r,t.y=n.y)}function at(r,n){var t=r.r+n.r-1e-6,e=n.x-r.x,i=n.y-r.y;return t>0&&t*t>e*e+i*i}function ut(r){var n=r._,t=r.next._,e=n.r+t.r,i=(n.x*t.r+t.x*n.r)/e,s=(n.y*t.r+t.y*n.r)/e;return i*i+s*s}function O(r){this._=r,this.next=null,this.previous=null}function $t(r,n){if(!(s=(r=Ft(r)).length))return 0;var t,e,i,s,a,l,u,o,f,x,c;if(t=r[0],t.x=0,t.y=0,!(s>1))return t.r;if(e=r[1],t.x=-e.r,e.x=t.r,e.y=0,!(s>2))return t.r+e.r;st(e,t,i=r[2]),t=new O(t),e=new O(e),i=new O(i),t.next=i.previous=e,e.next=t.previous=i,i.next=e.previous=t;t:for(u=3;u<s;++u){st(t._,e._,i=r[u]),i=new O(i),o=e.next,f=t.previous,x=e._.r,c=t._.r;do if(x<=c){if(at(o._,i._)){e=o,t.next=e,e.previous=t,--u;continue t}x+=o._.r,o=o.next}else{if(at(f._,i._)){t=f,t.next=e,e.previous=t,--u;continue t}c+=f._.r,f=f.previous}while(o!==f.next);for(i.previous=t,i.next=e,t.next=e.previous=e=i,a=ut(t);(i=i.next)!==e;)(l=ut(i))<a&&(t=i,a=l);e=t.next}for(t=[e._],i=e;(i=i.next)!==e;)t.push(i._);for(i=Ut(t,n),u=0;u<s;++u)t=r[u],t.x-=i.x,t.y-=i.y;return i.r}function Jt(r){return Math.sqrt(r.value)}function Kt(){var r=null,n=1,t=1,e=nt;function i(s){const a=Ht();return s.x=n/2,s.y=t/2,r?s.eachBefore(lt(r)).eachAfter(Y(e,.5,a)).eachBefore(ot(1)):s.eachBefore(lt(Jt)).eachAfter(Y(nt,1,a)).eachAfter(Y(e,s.r/Math.min(n,t),a)).eachBefore(ot(Math.min(n,t)/(2*s.r))),s}return i.radius=function(s){return arguments.length?(r=Ot(s),i):r},i.size=function(s){return arguments.length?(n=+s[0],t=+s[1],i):[n,t]},i.padding=function(s){return arguments.length?(e=typeof s=="function"?s:Tt(+s),i):e},i}function lt(r){return function(n){n.children||(n.r=Math.max(0,+r(n)||0))}}function Y(r,n,t){return function(e){if(i=e.children){var i,s,a=i.length,l=r(e)*n||0,u;if(l)for(s=0;s<a;++s)i[s].r+=l;if(u=$t(i,t),l)for(s=0;s<a;++s)i[s].r-=l;e.r=u+l}}}function ot(r){return function(n){var t=n.parent;n.r*=r,t&&(n.x=t.x+r*n.x,n.y=t.y+r*n.y)}}class J extends ht{constructor(){super(...arguments),Object.defineProperty(this,"_dataItem",{enumerable:!0,configurable:!0,writable:!0,value:this.makeDataItem({})}),Object.defineProperty(this,"_clusterIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_clusters",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"clusteredDataItems",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_scatterIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_scatters",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_packLayout",{enumerable:!0,configurable:!0,writable:!0,value:Kt()}),Object.defineProperty(this,"_spiral",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_clusterDP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_previousZL",{enumerable:!0,configurable:!0,writable:!0,value:0})}_afterNew(){this.fields.push("groupId"),this._setRawDefault("groupIdField","groupId"),super._afterNew()}_updateChildren(){super._updateChildren(),this.isDirty("scatterRadius")&&(this._spiral=Pt(0,0,300,300,0,3,3,0,0));const n=this.chart;if(n){const t=n.get("zoomLevel",1);if(t!=this._previousZL){const e=this.get("clusterDelay",0);e?this._clusterDP?(this._clusterDP.dispose(),this._clusterDP=this.setTimeout(()=>{this._doTheCluster()},e)):(this._doTheCluster(),this._clusterDP=this.setTimeout(()=>{},0)):this._doTheCluster(),this._previousZL=t}v(this.clusteredDataItems,e=>{const i=e.get("bullet"),s=e.get("longitude",0),a=e.get("latitude",0);this._positionBulletReal(i,{type:"Point",coordinates:[s,a]},[s,a])})}}_doTheCluster(){const n={};v(this.dataItems,t=>{const e=t.get("groupId","_default");n[e]||(n[e]=[]),n[e].push(t)}),this._scatterIndex=-1,this._scatters=[],this._clusterIndex=-1,this._clusters=[],v(this.clusteredDataItems,t=>{t.setRaw("children",void 0)}),v(this.dataItems,t=>{t.setRaw("cluster",void 0)}),rt(n,(t,e)=>{this._scatterGroup(e)}),rt(n,(t,e)=>{this._clusterGroup(e)}),v(this.dataItems,t=>{if(!t.get("cluster")){const e=t.bullets;e&&v(e,i=>{const s=i.get("sprite");s&&s.set("forceHidden",!1)})}})}zoomToCluster(n,t){this.zoomToDataItems(n.get("children",[]),t)}_clusterGroup(n){const t=this.chart;if(!(t&&t.get("zoomLevel",1)>=t.get("maxZoomLevel",100)*this.get("stopClusterZoom",.95)))for(n.sort((s,a)=>{const l=s.get("point"),u=a.get("point");return l&&u?Math.hypot(l.x-u.x,l.y-u.y):0});n.length>0;){this._clusterIndex++,this._clusters[this._clusterIndex]=[];const s=this._clusters[this._clusterIndex],a=n[0];s.push(a),U(n,a),this._clusterDataItem(a,n)}let e=0;const i=this.get("clusteredBullet");i&&v(this._clusters,s=>{let a=0,l=0,u=s.length;if(u>1){let o=this.clusteredDataItems[e];if(!o){o=new Mt(this,void 0,{});const p=o.set("bullet",i(this._root,this,o));if(p){const d=p.get("sprite");d&&(this.bulletsContainer.children.push(d),d._setDataItem(o),this.root.events.once("frameended",()=>{d instanceof et&&d.walkChildren(y=>{y instanceof Ct&&y.markDirtyValues()})}))}this.clusteredDataItems.push(o)}let f;v(s,p=>{p.setRaw("cluster",o);const d=p.get("point");d&&(a+=d.x,l+=d.y);const y=p.bullets;y&&v(y,j=>{const D=j.get("sprite");D&&D.set("forceHidden",!0)}),f=p.get("groupId")});let x=a/u,c=l/u;o.setRaw("children",s),o.setRaw("groupId",f);const h=o.get("value");o.setRaw("value",u);const g=o.get("bullet");if(g){let p=this.chart.invert({x,y:c});p&&o.setAll({longitude:p.longitude,latitude:p.latitude}),this._positionBullets(o);const d=g.get("sprite");d&&(d.set("forceHidden",!1),h!=u&&d instanceof et&&d.walkChildren(y=>{y instanceof Et&&y.text.markDirtyText()}))}e++}}),v(this.clusteredDataItems,s=>{let a=s.get("children");if(!a||a.length==0){const l=s.get("bullet");if(l){const u=l.get("sprite");u&&u.set("forceHidden",!0)}}})}_onDataClear(){super._onDataClear(),v(this.clusteredDataItems,n=>{const t=n.get("bullet");if(t){const e=t.get("sprite");e&&e.dispose()}}),this.clusteredDataItems=[]}_clusterDataItem(n,t){const e=n.get("point");if(e){let i=this.get("minDistance",20);const s=this._clusters[this._clusterIndex];for(let a=t.length-1;a>=0;a--){const l=t[a];if(l&&!l.get("clipped")){const u=l.get("point");u&&Math.hypot(u.x-e.x,u.y-e.y)<i&&(s.push(l),U(t,l),this._clusterDataItem(l,t))}}}}_scatterGroup(n){const t=this.chart;if(t&&t.get("zoomLevel",1)>=t.get("maxZoomLevel",100)*this.get("stopClusterZoom",.95)){for(;n.length>0;){this._scatterIndex++,this._scatters[this._scatterIndex]=[];const e=this._scatters[this._scatterIndex],i=n[0];e.push(i),jt(n,i),this._scatterDataItem(i,n)}v(this._scatters,e=>{if(e.length>1){let s=[],a=0,l=this.get("scatterRadius",8);v(e,u=>{let o=this._spiral[a],f=!0;if(s.length>0)for(;f;)v(s,g=>{for(f=!1;It({x:o.x,y:o.y,radius:l},g);)a++,this._spiral[a]==null?f=!1:(f=!0,o=this._spiral[a])});const x=o.x,c=o.y;s.push({x,y:c,radius:l}),u.set("dx",x),u.set("dy",c);const h=u.bullets;h&&v(h,g=>{const p=g.get("sprite");p&&p.setAll({dx:x,dy:c})})})}})}}_scatterDataItem(n,t){const e=n.get("point");if(e){const i=this.get("scatterDistance",5),s=this._scatters[this._scatterIndex];v(t,a=>{if(a&&!a.get("clipped")){const l=a.get("point");l&&Math.hypot(l.x-e.x,l.y-e.y)<i&&(s.push(a),U(t,a),this._scatterDataItem(a,t))}})}}}Object.defineProperty(J,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ClusteredPointSeries"});Object.defineProperty(J,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:ht.classNames.concat([J.className])});export{J as ClusteredPointSeries,ve as DefaultTheme,pe as GraticuleSeries,ye as MapChart,ge as MapLine,de as MapLineSeries,ht as MapPointSeries,me as MapPolygon,_e as MapPolygonSeries,be as MapSeries,Re as ZoomControl,ae as geoAlbersUsa,le as geoEqualEarth,ue as geoEquirectangular,we as geoMercator,oe as geoNaturalEarth1,ce as geoOrthographic,De as getGeoArea,Pe as getGeoBounds,Me as getGeoCentroid,Ce as getGeoCircle,Ee as getGeoRectangle,Ie as normalizeGeoPoint};

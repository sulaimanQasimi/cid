import{a2 as N,aa as p,C as L,m as c,L as P,G as O,E as R,e as _}from"./SerialChart-EVgi4eFE.js";import{R as x}from"./Button-63DswVvz.js";import{z as k}from"./Theme-Dgo0XspA.js";class w extends N{constructor(){super(...arguments),Object.defineProperty(this,"itemContainers",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new p(k.new({}),()=>L._new(this._root,{themeTags:c(this.itemContainers.template.get("themeTags",[]),["legend","item"]),themeTagsSelf:c(this.itemContainers.template.get("themeTagsSelf",[]),["itemcontainer"]),background:x.new(this._root,{themeTags:c(this.itemContainers.template.get("themeTags",[]),["legend","item","background"]),themeTagsSelf:c(this.itemContainers.template.get("themeTagsSelf",[]),["itemcontainer"])})},[this.itemContainers.template])))}),Object.defineProperty(this,"markers",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new p(k.new({}),()=>L._new(this._root,{themeTags:c(this.markers.template.get("themeTags",[]),["legend","marker"])},[this.markers.template])))}),Object.defineProperty(this,"labels",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new p(k.new({}),()=>P._new(this._root,{themeTags:c(this.labels.template.get("themeTags",[]),["legend","label"])},[this.labels.template])))}),Object.defineProperty(this,"valueLabels",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new p(k.new({}),()=>P._new(this._root,{themeTags:c(this.valueLabels.template.get("themeTags",[]),["legend","label","value"])},[this.valueLabels.template])))}),Object.defineProperty(this,"markerRectangles",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new p(k.new({}),()=>x._new(this._root,{themeTags:c(this.markerRectangles.template.get("themeTags",[]),["legend","marker","rectangle"])},[this.markerRectangles.template])))})}_afterNew(){this._settings.themeTags=c(this._settings.themeTags,["legend"]),this.fields.push("name","stroke","fill"),super._afterNew()}makeItemContainer(e){const t=this.children.push(this.itemContainers.make());return t._setDataItem(e),this.itemContainers.push(t),t.states.create("disabled",{}),t}makeMarker(){const e=this.markers.make();return this.markers.push(e),e.states.create("disabled",{}),e}makeLabel(){const e=this.labels.make();return e.states.create("disabled",{}),e}makeValueLabel(){const e=this.valueLabels.make();return e.states.create("disabled",{}),e}makeMarkerRectangle(){const e=this.markerRectangles.make();return e.states.create("disabled",{}),e}processDataItem(e){super.processDataItem(e);const t=this.makeItemContainer(e),a=this.get("nameField"),r=this.get("fillField"),l=this.get("strokeField");if(t){const o=this.get("clickTarget","itemContainer"),s=e.dataContext;s&&s.set&&s.set("legendDataItem",e),t._setDataItem(e),e.set("itemContainer",t);const n=this.makeMarker();if(n){t.children.push(n),n._setDataItem(e),e.set("marker",n);const i=this.get("useDefaultMarker"),f=n.children.push(this.makeMarkerRectangle());let d=e.get("fill"),m=e.get("stroke");e.set("markerRectangle",f),s&&s.get&&(d=s.get(r,d),m=s.get(l,m)),m||(m=d),i?s.on&&(s.on(r,()=>{f.set("fill",s.get(r))}),s.on(l,()=>{f.set("stroke",s.get(l))})):s&&s.createLegendMarker&&s.createLegendMarker(),f.setAll({fill:d,stroke:m});const b=s.component;b&&b.updateLegendMarker&&b.updateLegendMarker(s)}const h=this.makeLabel();if(h){t.children.push(h),h._setDataItem(e),e.set("label",h),h.text.on("text",()=>{t.setRaw("ariaLabel",h.text._getText()+(this.get("clickTarget")!=="none"?"; "+this._t("Press ENTER to toggle"):"")),t.markDirtyAccessibility()}),s&&s.get&&e.set("name",s.get(a));let i=e.get("name");i&&h.set("text",i)}const u=this.makeValueLabel();if(u&&(t.children.push(u),u._setDataItem(e),e.set("valueLabel",u)),s&&s.show&&(s.on("visible",i=>{t.set("disabled",!i)}),s.get("visible")||t.set("disabled",!0),o!="none")){let i=t;o=="marker"&&(i=n),this._addClickEvents(i,s,e)}this.children.values.sort((i,f)=>{const d=i.dataItem.dataContext,m=f.dataItem.dataContext;if(d&&m){const b=this.data.indexOf(d),y=this.data.indexOf(m);if(b>y)return 1;if(b<y)return-1}return 0}),s&&s.updateLegendValue&&s.updateLegendValue()}}_addClickEvents(e,t,a){e.set("cursorOverStyle","pointer"),e.events.on("pointerover",()=>{const r=t.component;r&&r.hoverDataItem&&r.hoverDataItem(t)}),e.events.on("pointerout",()=>{const r=t.component;r&&r.hoverDataItem&&r.unhoverDataItem(t)}),e.events.on("click",()=>{const r=a.get("label").text._getText();t.show&&t.isHidden&&(t.isHidden()||t.get("visible")===!1)?(t.show(),e.set("disabled",!1),this._root.readerAlert(this._t("%1 shown",this._root.locale,r))):t.hide&&(t.hide(),e.set("disabled",!0),this._root.readerAlert(this._t("%1 hidden",this._root.locale,r)))})}disposeDataItem(e){super.disposeDataItem(e);const t=e.dataContext;t&&t.get&&t.get("legendDataItem")==e&&t.set("legendDataItem",void 0);let a=e.get("itemContainer");a&&(this.itemContainers.removeValue(a),a.dispose());let r=e.get("marker");r&&(this.markers.removeValue(r),r.dispose());let l=e.get("markerRectangle");l&&(this.markerRectangles.removeValue(l),l.dispose());let o=e.get("label");o&&(this.labels.removeValue(o),o.dispose());let s=e.get("valueLabel");s&&(this.valueLabels.removeValue(s),s.dispose())}}Object.defineProperty(w,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Legend"});Object.defineProperty(w,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:N.classNames.concat([w.className])});function D(g,e){for(let t=0,a=e.length;t<a;t++){const r=e[t];if(r.length>0){let l=r[0];if(l.length>0){let o=l[0];g.moveTo(o.x,o.y);for(let s=0,n=r.length;s<n;s++)S(g,r[s])}}}}function S(g,e){for(let t=0,a=e.length;t<a;t++){const r=e[t];g.lineTo(r.x,r.y)}}class v extends O{_beforeChanged(){super._beforeChanged(),(this.isDirty("points")||this.isDirty("segments")||this._sizeDirty||this.isPrivateDirty("width")||this.isPrivateDirty("height"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){const e=this.get("points"),t=this.get("segments");if(e&&e.length>0){let a=e[0];this._display.moveTo(a.x,a.y),D(this._display,[[e]])}else if(t)D(this._display,t);else if(!this.get("draw")){let a=this.width(),r=this.height();this._display.moveTo(0,0),this._display.lineTo(a,r)}}}}Object.defineProperty(v,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Line"});Object.defineProperty(v,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:O.classNames.concat([v.className])});class C extends v{}Object.defineProperty(C,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Tick"});Object.defineProperty(C,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:v.classNames.concat([C.className])});class T extends R{_afterNew(){super._afterNewApplyThemes(),this._dirty.colors=!1}_beforeChanged(){this.isDirty("colors")&&this.reset()}generateColors(){this.setPrivate("currentPass",this.getPrivate("currentPass",0)+1);const e=this.getPrivate("currentPass"),t=this.get("colors",[this.get("baseColor",_.fromHex(16711680))]);this.getPrivate("numColors")||this.setPrivate("numColors",t.length);const a=this.getPrivate("numColors"),r=0,l=this.get("passOptions"),o=this.get("reuse");for(let s=r;s<a;s++)if(o)t.push(t[s]);else{const n=t[s].toHSL();let h=n.h+(l.hue||0)*e;for(;h>1;)h-=1;let u=n.s+(l.saturation||0)*e;u>1&&(u=1),u<0&&(u=0);let i=n.l+(l.lightness||0)*e;for(;i>1;)i-=1;t.push(_.fromHSL(h,u,i))}}getIndex(e){const t=this.get("colors",[]),a=this.get("saturation");return e>=t.length?(this.generateColors(),this.getIndex(e)):a!=null?_.saturate(t[e],a):t[e]}next(){let e=this.getPrivate("currentStep",this.get("startIndex",0));return this.setPrivate("currentStep",e+this.get("step",1)),this.getIndex(e)}reset(){this.setPrivate("currentStep",this.get("startIndex",0)),this.setPrivate("currentPass",0)}}Object.defineProperty(T,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ColorSet"});Object.defineProperty(T,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:R.classNames.concat([T.className])});export{T as C,w as L,C as T,v as a};

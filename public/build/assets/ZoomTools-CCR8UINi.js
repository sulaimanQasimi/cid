import{C as l,R as T,p as _,c as j,a6 as z,f as N,G as m}from"./SerialChart-CAnqEg8j.js";import{B as p}from"./Button-Dxks9qV6.js";import{f as w,u as y,d as B,M as L}from"./Theme-Dgo0XspA.js";class d extends l{constructor(){super(...arguments),Object.defineProperty(this,"_za",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_txa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tya",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_movePoints",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_downScale",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"_downX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_downY",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_pinchDP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contents",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(l.new(this._root,{width:_,height:_,x:0,y:0,draggable:!0,background:T.new(this._root,{fill:j(16777215),fillOpacity:0})}))}),Object.defineProperty(this,"_wheelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}_afterNew(){super._afterNew();const s=this.contents.events;this._disposers.push(s.on("pointerdown",e=>{this._handleThisDown(e)})),this._disposers.push(s.on("globalpointerup",e=>{this._handleThisUp(e)})),this._disposers.push(s.on("globalpointermove",e=>{this._handleThisMove(e)}));const t=this.contents.get("background");t&&(t.adapters.add("width",e=>Number(e)*20),t.adapters.add("height",e=>Number(e)*20),t.adapters.add("x",e=>Number(e)-t.width()/2),t.adapters.add("y",e=>Number(e)-t.height()/2));const o=this.contents;o.adapters.add("x",e=>{const i=o.get("scale",1);if(w(e)&&i>=1){let n=this.get("maxPanOut",.4),r=o.width();e=Math.min(r*n,e),e=Math.max(this.width()-r*i*(1+n),e)}return e}),o.adapters.add("y",e=>{const i=o.get("scale",1);if(w(e)&&i>=1){let n=this.get("maxPanOut",.4),r=o.height();e=Math.min(r*n,e),e=Math.max(this.height()-r*i*(1+n),e)}return e})}_prepareChildren(){super._prepareChildren(),this.isDirty("wheelable")&&this._handleSetWheel(),this.contents._display.cancelTouch=this.get("pinchZoom",!1)}_handleSetWheel(){this.get("wheelable")?(this._wheelDp&&this._wheelDp.dispose(),this._wheelDp=this.events.on("wheel",s=>{const t=s.originalEvent;if(z(t,this))t.preventDefault();else return;const o=this.toLocal(s.point);this._handleWheelZoom(t.deltaY,o)}),this._disposers.push(this._wheelDp)):this._wheelDp&&this._wheelDp.dispose()}_handleWheelZoom(s,t){let o=this.get("zoomStep",2),e=this.contents.get("scale",1),i=e;s>0?i=e/o:s<0&&(i=e*o),i!=e&&this.zoomToPoint(t,i)}zoomToPoint(s,t){t&&(t=N(t,this.get("minZoomLevel",1),this.get("maxZoomLevel",32)));const o=this.contents.get("scale",1);let e=s.x,i=s.y,n=e,r=i;const h=this.contents;let f=h.x(),a=h.y(),u=n-(e-f)/o*t,c=r-(i-a)/o*t;return this._animateTo(u,c,t),this._za}zoomIn(){return this.zoomToPoint({x:this.width()/2,y:this.height()/2},this.contents.get("scale",1)*this.get("zoomStep",2))}zoomOut(){return this.zoomToPoint({x:this.width()/2,y:this.height()/2},this.contents.get("scale",1)/this.get("zoomStep",2))}goHome(){return this._animateTo(0,0,1)}_animateTo(s,t,o){const e=this.get("animationDuration",0),i=this.get("animationEasing"),n=this.contents;this._txa=n.animate({key:"x",to:s,duration:e,easing:i}),this._tya=n.animate({key:"y",to:t,duration:e,easing:i}),this._za=n.animate({key:"scale",to:o,duration:e,easing:i})}_handleThisUp(s){this._downPoints={}}_handleThisDown(s){const t=this.contents;this._downScale=t.get("scale",1);const o=t._downPoints;let e=y(o).length;if(e==1){let i=o[1];i||(i=o[0]),i&&i.x==s.point.x&&i.y==s.point.y&&(e=0)}if(e>0){this._downX=t.x(),this._downY=t.y();const i=t._getDownPointId();if(i){let n=this._movePoints[i];n&&(t._downPoints[i]=n)}}}_handleThisMove(s){const o=s.originalEvent.pointerId;if(this.get("pinchZoom")&&o&&(this._movePoints[o]=s.point,y(this.contents._downPoints).length>1)){this._handlePinch();return}}_handlePinch(){let s=0,t=[],o=[];if(B(this.contents._downPoints,(e,i)=>{t[s]=i;let n=this._movePoints[e];n&&(o[s]=n),s++}),t.length>1&&o.length>1){this.contents._isDragging=!1;let e=t[0],i=t[1],n=o[0],r=o[1];if(e&&i&&n&&r){e=this.toLocal(e),i=this.toLocal(i),n=this.toLocal(n),r=this.toLocal(r);let h=Math.hypot(i.x-e.x,i.y-e.y),a=Math.hypot(r.x-n.x,r.y-n.y)/h*this._downScale,u={x:n.x+(r.x-n.x)/2,y:n.y+(r.y-n.y)/2},c={x:e.x+(i.x-e.x)/2,y:e.y+(i.y-e.y)/2},P=this._downX||0,x=this._downY||0,b=this._downScale,O=u.x-(-P+c.x)/b*a,D=u.y-(-x+c.y)/b*a;this.contents.setAll({x:O,y:D,scale:a})}}}}Object.defineProperty(d,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ZoomableContainer"});Object.defineProperty(d,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:l.classNames.concat([d.className])});class g extends l{constructor(){super(...arguments),Object.defineProperty(this,"homeButton",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(p.new(this._root,{width:35,height:35,themeTags:["home"]}))}),Object.defineProperty(this,"plusButton",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(p.new(this._root,{width:35,height:35,themeTags:["plus"]}))}),Object.defineProperty(this,"minusButton",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(p.new(this._root,{width:35,height:35,themeTags:["minus"]}))}),Object.defineProperty(this,"_disposer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_targetDisposer",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}_afterNew(){super._afterNew(),this.set("position","absolute"),this.set("layout",this._root.verticalLayout),this.addTag("zoomtools"),this.plusButton.setAll({icon:m.new(this._root,{themeTags:["icon"]}),layout:void 0}),this.minusButton.setAll({icon:m.new(this._root,{themeTags:["icon"]}),layout:void 0}),this.homeButton.setAll({icon:m.new(this._root,{themeTags:["icon"]}),layout:void 0})}_prepareChildren(){if(super._prepareChildren(),this.isDirty("target")){const s=this.get("target"),t=this._prevSettings.target;s&&(s instanceof d&&(this._targetDisposer=this.addDisposer(s.contents.on("scale",o=>{o==s.get("minZoomLevel")?this.minusButton.set("disabled",!0):this.minusButton.set("disabled",!1),o==s.get("maxZoomLevel")?this.plusButton.set("disabled",!0):this.plusButton.set("disabled",!1)})),this.root.events.once("frameended",()=>{s.get("scale")==s.get("minZoomLevel")&&this.minusButton.set("disabled",!0)})),this._disposer=new L([this.plusButton.events.on("click",()=>{s.zoomIn()}),this.minusButton.events.on("click",()=>{s.zoomOut()}),this.homeButton.events.on("click",()=>{s.goHome()})])),t&&(this._disposer&&this._disposer.dispose(),this._targetDisposer&&this._targetDisposer.dispose())}}}Object.defineProperty(g,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ZoomTools"});Object.defineProperty(g,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:l.classNames.concat([g.className])});export{g as Z,d as a};

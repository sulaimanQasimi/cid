import{m as K,r as _,j as e,L as U,$ as E,a as X}from"./app-Czsz3ga9.js";import{B as x}from"./button-CKdllIOS.js";import{C as u,a as j,b as g,c as f,d as v,e as z}from"./card-BHa63vbK.js";import{I as b}from"./input-CyzPLHPg.js";import{L as n}from"./label-BpxGcMk3.js";import{T as C}from"./textarea-CcWYeMMo.js";import{S,a as N,b as y,c as w,d as c}from"./select-BF7ygK_5.js";import{P as G}from"./page-header-CHU0HS7M.js";import{A as J}from"./app-layout-SMAHjsOb.js";import{I as p}from"./input-error-RV-JOBeR.js";import{T as M}from"./TreeViewStatSelector-GdlGDnqF.js";import{u as Q}from"./translate-BwqIl_WO.js";import{A as W}from"./arrow-left-DuBn3N8j.js";import{S as Y}from"./save-iW3X8p4j.js";import"./index-B97srWOL.js";import"./index-Cm_rdgC6.js";import"./index-B2uJwltq.js";import"./index-BugM-CEt.js";import"./createLucideIcon-DJy6bF42.js";import"./index-CrT4wfWz.js";import"./check-DwCBjevf.js";import"./x-Bu793gJv.js";import"./index-DRTj8I4Z.js";import"./avatar-DKeaeSW8.js";import"./app-logo-DhSe7mJZ.js";import"./app-logo-icon-DbyAI1nt.js";import"./triangle-alert-CBAp-B0X.js";import"./file-text-rlW4jRe5.js";import"./users--TnmxFgG.js";import"./tag-C2luWRjz.js";import"./qr-code-GVeF0qj1.js";function Ae({report:s,statItems:F,reportStats:A,statCategories:I}){const{t:r}=Q(),{data:o,setData:l,put:L,processing:k,errors:d}=K({report_number:s.report_number,report_date:s.report_date,security_level:s.security_level,details:s.details,action_taken:s.action_taken||"",recommendation:s.recommendation||"",report_status:s.report_status,source:s.source||""}),[T,D]=_.useState(()=>{const t={};return A.forEach(i=>{t[i.stat_category_item_id]={value:i.integer_value!==null?String(i.integer_value):i.string_value||"",notes:i.notes}}),t}),[Z,ee]=_.useState(null),[m,V]=_.useState(null),q=[{title:"Dashboard",href:"/dashboard"},{title:"Incident Reports",href:route("incident-reports.index")},{title:s.report_number,href:route("incident-reports.show",s.id)},{title:"Edit",href:route("incident-reports.edit",s.id)}];function R(t){t.preventDefault();const i=Object.entries(T).map(([a,{value:h,notes:$}])=>({stat_category_item_id:parseInt(a),value:h,notes:$}));L(route("incident-reports.update",s.id),{onSuccess:()=>{var a;i.length>0?X.post(route("incident-reports.stats.batch-update",s.id),{stats:i},{headers:{"X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||"","Content-Type":"application/json",Accept:"application/json"}}).then(()=>{window.location.href=route("incident-reports.show",s.id)}).catch(h=>{console.error("Error updating stats:",h)}):window.location.href=route("incident-reports.show",s.id)}})}const B=m?F.filter(t=>t.category.id===m):F,H=I.map(t=>({id:t.id,label:t.label,color:t.color}));function O(t,i){D(a=>({...a,[t]:{...a[t]||{notes:null},value:i}}))}function P(t,i){D(a=>({...a,[t]:{...a[t]||{value:""},notes:i||null}}))}return e.jsxs(J,{breadcrumbs:q,children:[e.jsx(U,{title:r("incident_reports.edit.page_title",{number:s.report_number})}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(G,{title:r("incident_reports.edit.page_header",{number:s.report_number}),description:r("incident_reports.edit.page_description"),actions:e.jsx("div",{className:"flex space-x-2",children:e.jsx(x,{variant:"outline",asChild:!0,children:e.jsxs(E,{href:route("incident-reports.show",s.id),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),r("incident_reports.actions.back_to_report")]})})})}),e.jsx("form",{onSubmit:R,children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsx(g,{children:r("incident_reports.form.info_title")}),e.jsx(f,{children:r("incident_reports.form.info_description")})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsx(n,{htmlFor:"report_number",children:r("incident_reports.form.report_number")}),e.jsx(b,{id:"report_number",value:o.report_number,onChange:t=>l("report_number",t.target.value),disabled:!0}),e.jsx(p,{message:d.report_number})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(n,{htmlFor:"report_date",children:r("incident_reports.form.report_date")}),e.jsx(b,{id:"report_date",type:"date",value:o.report_date,onChange:t=>l("report_date",t.target.value),required:!0}),e.jsx(p,{message:d.report_date})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(n,{htmlFor:"security_level",children:r("incident_reports.form.security_level")}),e.jsxs(S,{value:o.security_level,onValueChange:t=>l("security_level",t),children:[e.jsx(N,{id:"security_level",children:e.jsx(y,{placeholder:r("incident_reports.form.security_level_placeholder")})}),e.jsxs(w,{children:[e.jsx(c,{value:"normal",children:r("incident_reports.level.normal")}),e.jsx(c,{value:"restricted",children:r("incident_reports.level.restricted")}),e.jsx(c,{value:"classified",children:r("incident_reports.level.classified")})]})]}),e.jsx(p,{message:d.security_level})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(n,{htmlFor:"report_status",children:r("incident_reports.form.status")}),e.jsxs(S,{value:o.report_status,onValueChange:t=>l("report_status",t),children:[e.jsx(N,{id:"report_status",children:e.jsx(y,{placeholder:r("incident_reports.form.status_placeholder")})}),e.jsxs(w,{children:[e.jsx(c,{value:"submitted",children:r("incident_reports.status.submitted")}),e.jsx(c,{value:"reviewed",children:r("incident_reports.status.reviewed")}),e.jsx(c,{value:"approved",children:r("incident_reports.status.approved")})]})]}),e.jsx(p,{message:d.report_status})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(n,{htmlFor:"source",children:r("incident_reports.form.source_label")}),e.jsx(b,{id:"source",value:o.source,onChange:t=>l("source",t.target.value),placeholder:r("incident_reports.form.source_placeholder")}),e.jsx(p,{message:d.source})]})]})]}),e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsx(g,{children:r("incident_reports.details.title")}),e.jsx(f,{children:r("incident_reports.details.edit_description")})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsx(n,{htmlFor:"details",children:r("incident_reports.details.details_label")}),e.jsx(C,{id:"details",rows:5,value:o.details,onChange:t=>l("details",t.target.value),placeholder:r("incident_reports.details.details_placeholder"),required:!0}),e.jsx(p,{message:d.details})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(n,{htmlFor:"action_taken",children:r("incident_reports.details.action_taken_label")}),e.jsx(C,{id:"action_taken",rows:3,value:o.action_taken,onChange:t=>l("action_taken",t.target.value),placeholder:r("incident_reports.details.action_taken_placeholder")}),e.jsx(p,{message:d.action_taken})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(n,{htmlFor:"recommendation",children:r("incident_reports.details.recommendation_label")}),e.jsx(C,{id:"recommendation",rows:3,value:o.recommendation,onChange:t=>l("recommendation",t.target.value),placeholder:r("incident_reports.details.recommendation_placeholder")}),e.jsx(p,{message:d.recommendation})]})]})]}),e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsx(g,{children:r("incident_reports.stats.title")}),e.jsx(f,{children:r("incident_reports.stats.description")})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(n,{htmlFor:"category-filter",children:r("incident_reports.stats.filter_by_category")}),e.jsxs(S,{value:(m==null?void 0:m.toString())||"all",onValueChange:t=>V(t!=="all"?parseInt(t):null),children:[e.jsx(N,{id:"category-filter",children:e.jsx(y,{placeholder:r("incidents.filters.all_categories")})}),e.jsxs(w,{children:[e.jsx(c,{value:"all",children:r("incidents.filters.all_categories")}),H.map(t=>e.jsx(c,{value:t.id.toString(),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-2 h-3 w-3 rounded-full",style:{backgroundColor:t.color}}),t.label]})},t.id))]})]})]}),e.jsx(M,{items:B,statsData:T,onValueChange:O,onNotesChange:P})]})]}),e.jsx(u,{children:e.jsxs(z,{className:"flex justify-end space-x-2 pt-6",children:[e.jsx(x,{variant:"outline",asChild:!0,type:"button",children:e.jsx(E,{href:route("incident-reports.show",s.id),children:r("common.cancel")})}),e.jsxs(x,{type:"submit",disabled:k,children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),r(k?"incident_reports.actions.saving":"incident_reports.actions.save_changes")]})]})})]})})]})]})}export{Ae as default};

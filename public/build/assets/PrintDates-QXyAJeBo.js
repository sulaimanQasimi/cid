import{r as u,U as C,j as e,L as E}from"./app-3tDC9xQW.js";import{B as j}from"./button-C7E4w2kB.js";import{u as Y}from"./translate-BvmSHp8j.js";import{a as I}from"./date-BaJKjiu2.js";import{m as L}from"./index-2sXO8O_d.js";import{A as H}from"./arrow-left-BKKKrdBt.js";import{S as B,X as U}from"./x-B2ZDNZYW.js";import{F as S}from"./file-text-pL_1YHne.js";import{T as F}from"./tag-EFcppGe5.js";import{T}from"./tablet-smartphone-DknG7j0Z.js";import{f as G}from"./index-CaunA62S.js";import"./utils-D9L8Nuxo.js";import"./createLucideIcon-CDtKsWnV.js";function se({sub_items:N=[],statSums:_=[],dateFrom:p,dateTo:h}){const{t:s}=Y(),[M,x]=u.useState(!1),[b,v]=u.useState("labels"),[i,D]=u.useState({governmentName:"امارت اسلامی افغانستان",ministryName:"وزارت دفاع",reportTitle:"گزارش مرکز ملی بصیرت",dateFormat:"persian"}),w=C.useMemo(()=>_.reduce((t,r)=>{const a=r.category_name||"بدون دسته‌بندی";return t[a]||(t[a]=[]),t[a].push(r),t},{}),[_]),k=C.useMemo(()=>{const r=[];let a={},n=0;return Object.entries(w).sort((l,o)=>l[1].length-o[1].length).forEach(([l,o])=>{if(o.length>80){n>0&&(r.push(a),a={},n=0);for(let d=0;d<o.length;d+=80){const y=o.slice(d,d+80);r.push({[l]:y})}}else n+o.length>80&&n>0&&(r.push(a),a={},n=0),a[l]=o,n+=o.length}),n>0&&r.push(a),r},[w]),$=()=>{window.print()},A=()=>{window.history.back()},c=(t,r)=>{D(a=>({...a,[t]:r}))},O=t=>{var r,a,n;try{const l=new Intl.DateTimeFormat("en-US-u-ca-islamic",{year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(t),o=((r=l.find(g=>g.type==="year"))==null?void 0:r.value)||"",d=((a=l.find(g=>g.type==="month"))==null?void 0:a.value)||"",y=((n=l.find(g=>g.type==="day"))==null?void 0:n.value)||"";return`${o}/${d.padStart(2,"0")}/${y.padStart(2,"0")}`}catch(f){console.error("Error converting to Hijri:",f);const l=Math.floor((t.getFullYear()-622)*.970224),o=Math.floor((t.getMonth()+1)*.970224),d=Math.floor(t.getDate()*.970224);return`${l}/${o.toString().padStart(2,"0")}/${d.toString().padStart(2,"0")}`}},P=t=>I(t.toISOString()),z=t=>{if(!t)return null;try{if(t.includes("/")){const a=L(t,"jYYYY/jMM/jDD");if(a.isValid())return a.toDate()}const r=new Date(t);return isNaN(r.getTime())?null:r}catch(r){return console.error("Error parsing date:",r),null}},m=t=>{if(!t)return"-";try{const r=z(t);if(!r)return t;switch(i.dateFormat){case"hijri":return O(r);case"persian":return P(r);case"gregorian":default:return G(r,"yyyy/MM/dd")}}catch(r){return console.error("Error formatting date:",r),t}};return e.jsxs("div",{className:"print:m-0 print:max-w-none print:p-0",style:{fontFamily:"Amiri, serif"},children:[e.jsx(E,{title:s("national_insight_center_info.print_dates.page_title")||"گزارش مرکز ملی بصیرت - بر اساس تاریخ"}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
                    @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');
                    
                    @media print {
                        @page {
                            size: A4 landscape;
                            margin: 2.5cm;
                        }
                        body {
                            font-size: 11px;
                            line-height: 1.5;
                            font-family: 'Amiri', serif !important;
                        }
                        * {
                            font-family: 'Amiri', serif !important;
                        }
                        .print\\:text-xs {
                            font-size: 9px !important;
                        }
                        .print\\:border-gray-800 {
                            border-color: #1f2937 !important;
                        }
                        .print\\:border-gray-600 {
                            border-color: #4b5563 !important;
                        }
                        .print\\:hidden {
                            display: none !important;
                        }
                        table {
                            page-break-inside: auto;
                        }
                        tr {
                            page-break-inside: avoid;
                            page-break-after: auto;
                        }
                    }
                `}}),e.jsx("div",{className:"mb-6 print:hidden",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{onClick:A,variant:"outline",size:"lg",className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),s("national_insight_center_info.print.back_button")||"بازگشت"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{onClick:()=>x(!0),variant:"outline",size:"lg",className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),s("national_insight_center_info.print_dates.settings_button")||"تنظیمات چاپ"]}),e.jsxs(j,{onClick:$,size:"lg",className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700",children:[e.jsx(S,{className:"h-4 w-4"}),s("national_insight_center_info.print.print_button")||"چاپ"]})]})]})}),e.jsxs("div",{className:"print:page-break-inside-avoid relative mx-auto max-w-7xl px-4",children:[e.jsxs("div",{className:"mb-10 border-b-2 border-gray-300 pb-6 text-center print:border-gray-800",children:[e.jsxs("div",{className:"relative mb-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:"/images/logos/logo 1.png",alt:"logo",className:"h-20 w-20 object-contain print:h-16 print:w-16"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"mb-1 text-3xl font-bold text-gray-900 print:text-2xl",children:i.governmentName}),e.jsx("h2",{className:"mb-1 text-2xl font-semibold text-gray-800 print:text-xl",children:i.ministryName}),e.jsx("h3",{className:"text-xl font-medium text-gray-700 print:text-lg",children:i.reportTitle})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:"/images/logos/logo 2.png",alt:"logo",className:"h-20 w-20 object-contain print:h-16 print:w-16"})})]}),e.jsx("div",{className:"mt-4 rounded-lg bg-gray-100 px-4 py-2 text-base font-medium text-gray-800 print:bg-gray-200 print:text-sm",children:p&&h?e.jsxs(e.Fragment,{children:["گزارش بر اساس از تاریخ ",m(p)," تا ",m(h)]}):p?e.jsxs(e.Fragment,{children:["گزارش بر اساس از تاریخ ",m(p)]}):h?e.jsxs(e.Fragment,{children:["گزارش بر اساس تا تاریخ ",m(h)]}):e.jsx(e.Fragment,{children:"گزارش کامل"})})]}),k.length>0&&e.jsx("div",{className:"mb-8 space-y-4",children:k.map((t,r)=>e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-300 print:border-gray-800",children:e.jsxs("table",{className:"border-collapse bg-white",style:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gradient-to-b from-gray-700 to-gray-800 text-white print:bg-gray-900",children:Object.entries(t).map(([a,n])=>e.jsx("th",{colSpan:n.length,className:"border border-gray-400 px-2 py-2 text-center text-xs font-bold print:border-gray-800 whitespace-nowrap",children:a},a))})}),e.jsxs("tbody",{children:[e.jsx("tr",{className:"bg-white print:bg-white",children:Object.values(t).flat().map((a,n)=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center text-xs text-gray-900 print:border-gray-800 align-middle",style:{writingMode:"vertical-rl",textOrientation:"mixed",whiteSpace:"nowrap",minWidth:"fit-content",height:"auto"},children:a.item_name},n))}),e.jsx("tr",{className:"bg-gray-50 print:bg-gray-100",children:Object.values(t).flat().map((a,n)=>e.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center text-xs font-medium text-gray-900 print:border-gray-800 whitespace-nowrap",children:a.total_integer_value??0},n))})]})]})})},r))}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold text-gray-900 print:text-lg",children:"جزئیات موارد"}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-300 print:border-gray-800",children:e.jsxs("table",{className:"min-w-full border-collapse bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-b from-gray-700 to-gray-800 text-white print:bg-gray-900",children:[e.jsx("th",{className:"border border-gray-400 px-4 py-3 text-center text-sm font-bold print:border-gray-800",children:"اداره"}),e.jsx("th",{className:"border border-gray-400 px-4 py-3 text-center text-sm font-bold print:border-gray-800",children:"ولایت"}),e.jsx("th",{className:"border border-gray-400 px-4 py-3 text-center text-sm font-bold print:border-gray-800",children:"ولسوالی"}),e.jsx("th",{className:"w-1/3 border border-gray-400 px-4 py-3 text-center text-sm font-bold print:border-gray-800",children:"توضیحات"}),e.jsx("th",{className:"border border-gray-400 px-4 py-3 text-center text-sm font-bold print:border-gray-800",children:"تاریخ"})]})}),e.jsx("tbody",{children:N.length>0?N.map((t,r)=>e.jsxs("tr",{className:`transition-colors ${r%2===0?"bg-white print:bg-white":"bg-gray-50 print:bg-gray-100"} hover:bg-gray-100 print:hover:bg-inherit`,children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-center text-sm text-gray-900 print:border-gray-800",children:t.department_name||"-"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-center text-sm text-gray-900 print:border-gray-800",children:t.province_name||"-"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-center text-sm text-gray-900 print:border-gray-800",children:t.district_name||"-"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-justify text-sm leading-relaxed text-gray-900 break-words whitespace-normal print:border-gray-800",children:t.description||"-"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-center text-sm font-medium text-gray-900 print:border-gray-800",children:m(t.date)})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"border border-gray-300 px-4 py-8 text-center text-sm text-gray-500 print:border-gray-800",children:"هیچ موردی یافت نشد"})})})]})})]})]}),M&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[e.jsx(S,{className:"mr-2 h-5 w-5"}),s("national_insight_center_info.print_dates.settings_title")||"تنظیمات چاپ"]}),e.jsx("button",{onClick:()=>x(!1),className:"text-gray-500 hover:text-gray-700 focus:outline-none",children:e.jsx(U,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex border-b",children:[e.jsx("button",{onClick:()=>v("labels"),className:`px-4 py-2 border-b-2 font-medium text-sm ${b==="labels"?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),s("national_insight_center_info.print_dates.settings.tabs.labels")||"عنوان‌ها"]})}),e.jsx("button",{onClick:()=>v("date_format"),className:`px-4 py-2 border-b-2 font-medium text-sm ${b==="date_format"?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),s("national_insight_center_info.print_dates.settings.tabs.date_format")||"فرمت تاریخ"]})})]}),b==="labels"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"mr-2 h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-md font-medium",children:s("national_insight_center_info.print_dates.settings_labels_title")||"عنوان‌ها"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("national_insight_center_info.print_dates.settings_government_name")||"نام دولت:"}),e.jsx("input",{type:"text",value:i.governmentName,onChange:t=>c("governmentName",t.target.value),className:"w-full border border-gray-300 rounded px-3 py-2 text-sm",placeholder:"امارت اسلامی افغانستان"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("national_insight_center_info.print_dates.settings_ministry_name")||"نام وزارت:"}),e.jsx("input",{type:"text",value:i.ministryName,onChange:t=>c("ministryName",t.target.value),className:"w-full border border-gray-300 rounded px-3 py-2 text-sm",placeholder:"وزارت دفاع"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("national_insight_center_info.print_dates.settings_report_title")||"عنوان گزارش:"}),e.jsx("input",{type:"text",value:i.reportTitle,onChange:t=>c("reportTitle",t.target.value),className:"w-full border border-gray-300 rounded px-3 py-2 text-sm",placeholder:"گزارش مرکز ملی بصیرت"})]})]})]}),b==="date_format"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"mr-2 h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-md font-medium",children:s("national_insight_center_info.print_dates.settings.date_format.title")||"فرمت تاریخ"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("national_insight_center_info.print_dates.settings.date_format.title")||"فرمت تاریخ"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"dateFormat",value:"gregorian",checked:i.dateFormat==="gregorian",onChange:t=>c("dateFormat",t.target.value),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:s("national_insight_center_info.print_dates.settings.date_format.gregorian")||"میلادی (Gregorian)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"dateFormat",value:"hijri",checked:i.dateFormat==="hijri",onChange:t=>c("dateFormat",t.target.value),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:s("national_insight_center_info.print_dates.settings.date_format.hijri")||"هجری (Hijri)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"dateFormat",value:"persian",checked:i.dateFormat==="persian",onChange:t=>c("dateFormat",t.target.value),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:s("national_insight_center_info.print_dates.settings.date_format.persian")||"شمسی (Persian)"})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:s("national_insight_center_info.print_dates.settings.date_format.preview")||"نمونه تاریخ:"}),e.jsx("div",{className:"text-sm text-gray-600",children:m(new Date().toISOString())})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx("h3",{className:"text-md font-medium mb-3",children:s("national_insight_center_info.print_dates.settings_preview")||"پیش‌نمایش"}),e.jsx("div",{className:"border rounded overflow-hidden bg-white p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-1 text-2xl font-bold text-gray-900",children:i.governmentName}),e.jsx("h2",{className:"mb-1 text-xl font-semibold text-gray-800",children:i.ministryName}),e.jsx("h3",{className:"text-lg font-medium text-gray-700",children:i.reportTitle})]})})]})]}),e.jsxs("div",{className:"border-t px-4 py-3 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:s("common.cancel")||"لغو"}),e.jsx("button",{onClick:()=>{x(!1)},className:"px-4 py-2 bg-primary border border-transparent rounded-md text-sm font-medium text-white hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:s("common.save")||"ذخیره"}),e.jsx("button",{onClick:()=>{x(!1),setTimeout(()=>window.print(),300)},className:"px-4 py-2 bg-purple-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:s("national_insight_center_info.print_dates.apply_and_print")||"ذخیره و چاپ"})]})]})})]})}export{se as default};

import{R as x,ad as b,f as g,C as m,m as D,p as O,c as R,a6 as z,G as v}from"./SerialChart-BtiA0Xmo.js";import{f,u as N,d as S,M}from"./Theme-BmHcCuAX.js";class _ extends x{_beforeChanged(){super._beforeChanged(),(this.isDirty("cornerRadiusTL")||this.isDirty("cornerRadiusTR")||this.isDirty("cornerRadiusBR")||this.isDirty("cornerRadiusBL"))&&(this._clear=!0)}_draw(){let i=this.width(),t=this.height(),o=i,e=t,s=o/Math.abs(i),n=e/Math.abs(t);if(f(o)&&f(e)){let r=Math.min(o,e)/2,a=b(this.get("cornerRadiusTL",8),r),c=b(this.get("cornerRadiusTR",8),r),l=b(this.get("cornerRadiusBR",8),r),u=b(this.get("cornerRadiusBL",8),r),d=Math.min(Math.abs(o/2),Math.abs(e/2));a=g(a,0,d),c=g(c,0,d),l=g(l,0,d),u=g(u,0,d);const h=this._display;h.moveTo(a*s,0),h.lineTo(o-c*s,0),c>0&&h.arcTo(o,0,o,c*n,c),h.lineTo(o,e-l*n),l>0&&h.arcTo(o,e,o-l*s,e,l),h.lineTo(u*s,e),u>0&&h.arcTo(0,e,0,e-u*n,u),h.lineTo(0,a*n),a>0&&h.arcTo(0,0,a*s,0,a),h.closePath()}}}Object.defineProperty(_,"className",{enumerable:!0,configurable:!0,writable:!0,value:"RoundedRectangle"});Object.defineProperty(_,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:x.classNames.concat([_.className])});class p extends m{_afterNew(){this._settings.themeTags=D(this._settings.themeTags,["button"]),super._afterNew(),this._settings.background||this.set("background",_.new(this._root,{themeTags:D(this._settings.themeTags,["background"])})),this.setPrivate("trustBounds",!0)}_prepareChildren(){if(super._prepareChildren(),this.isDirty("icon")){const i=this._prevSettings.icon,t=this.get("icon");t!==i&&(this._disposeProperty("icon"),i&&i.dispose(),t&&this.children.push(t),this._prevSettings.icon=t)}if(this.isDirty("label")){const i=this._prevSettings.label,t=this.get("label");t!==i&&(this._disposeProperty("label"),i&&i.dispose(),t&&this.children.push(t),this._prevSettings.label=t)}}}Object.defineProperty(p,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Button"});Object.defineProperty(p,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:m.classNames.concat([p.className])});class w extends m{constructor(){super(...arguments),Object.defineProperty(this,"_za",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_txa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tya",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_movePoints",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_downScale",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"_downX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_downY",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_pinchDP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contents",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(m.new(this._root,{width:O,height:O,x:0,y:0,draggable:!0,background:x.new(this._root,{fill:R(16777215),fillOpacity:0})}))}),Object.defineProperty(this,"_wheelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}_afterNew(){super._afterNew();const i=this.contents.events;this._disposers.push(i.on("pointerdown",e=>{this._handleThisDown(e)})),this._disposers.push(i.on("globalpointerup",e=>{this._handleThisUp(e)})),this._disposers.push(i.on("globalpointermove",e=>{this._handleThisMove(e)}));const t=this.contents.get("background");t&&(t.adapters.add("width",e=>Number(e)*20),t.adapters.add("height",e=>Number(e)*20),t.adapters.add("x",e=>Number(e)-t.width()/2),t.adapters.add("y",e=>Number(e)-t.height()/2));const o=this.contents;o.adapters.add("x",e=>{const s=o.get("scale",1);if(f(e)&&s>=1){let n=this.get("maxPanOut",.4),r=o.width();e=Math.min(r*n,e),e=Math.max(this.width()-r*s*(1+n),e)}return e}),o.adapters.add("y",e=>{const s=o.get("scale",1);if(f(e)&&s>=1){let n=this.get("maxPanOut",.4),r=o.height();e=Math.min(r*n,e),e=Math.max(this.height()-r*s*(1+n),e)}return e})}_prepareChildren(){super._prepareChildren(),this.isDirty("wheelable")&&this._handleSetWheel(),this.contents._display.cancelTouch=this.get("pinchZoom",!1)}_handleSetWheel(){this.get("wheelable")?(this._wheelDp&&this._wheelDp.dispose(),this._wheelDp=this.events.on("wheel",i=>{const t=i.originalEvent;if(z(t,this))t.preventDefault();else return;const o=this.toLocal(i.point);this._handleWheelZoom(t.deltaY,o)}),this._disposers.push(this._wheelDp)):this._wheelDp&&this._wheelDp.dispose()}_handleWheelZoom(i,t){let o=this.get("zoomStep",2),e=this.contents.get("scale",1),s=e;i>0?s=e/o:i<0&&(s=e*o),s!=e&&this.zoomToPoint(t,s)}zoomToPoint(i,t){t&&(t=g(t,this.get("minZoomLevel",1),this.get("maxZoomLevel",32)));const o=this.contents.get("scale",1);let e=i.x,s=i.y,n=e,r=s;const a=this.contents;let c=a.x(),l=a.y(),u=n-(e-c)/o*t,d=r-(s-l)/o*t;return this._animateTo(u,d,t),this._za}zoomIn(){return this.zoomToPoint({x:this.width()/2,y:this.height()/2},this.contents.get("scale",1)*this.get("zoomStep",2))}zoomOut(){return this.zoomToPoint({x:this.width()/2,y:this.height()/2},this.contents.get("scale",1)/this.get("zoomStep",2))}goHome(){return this._animateTo(0,0,1)}_animateTo(i,t,o){const e=this.get("animationDuration",0),s=this.get("animationEasing"),n=this.contents;this._txa=n.animate({key:"x",to:i,duration:e,easing:s}),this._tya=n.animate({key:"y",to:t,duration:e,easing:s}),this._za=n.animate({key:"scale",to:o,duration:e,easing:s})}_handleThisUp(i){this._downPoints={}}_handleThisDown(i){const t=this.contents;this._downScale=t.get("scale",1);const o=t._downPoints;let e=N(o).length;if(e==1){let s=o[1];s||(s=o[0]),s&&s.x==i.point.x&&s.y==i.point.y&&(e=0)}if(e>0){this._downX=t.x(),this._downY=t.y();const s=t._getDownPointId();if(s){let n=this._movePoints[s];n&&(t._downPoints[s]=n)}}}_handleThisMove(i){const o=i.originalEvent.pointerId;if(this.get("pinchZoom")&&o&&(this._movePoints[o]=i.point,N(this.contents._downPoints).length>1)){this._handlePinch();return}}_handlePinch(){let i=0,t=[],o=[];if(S(this.contents._downPoints,(e,s)=>{t[i]=s;let n=this._movePoints[e];n&&(o[i]=n),i++}),t.length>1&&o.length>1){this.contents._isDragging=!1;let e=t[0],s=t[1],n=o[0],r=o[1];if(e&&s&&n&&r){e=this.toLocal(e),s=this.toLocal(s),n=this.toLocal(n),r=this.toLocal(r);let a=Math.hypot(s.x-e.x,s.y-e.y),l=Math.hypot(r.x-n.x,r.y-n.y)/a*this._downScale,u={x:n.x+(r.x-n.x)/2,y:n.y+(r.y-n.y)/2},d={x:e.x+(s.x-e.x)/2,y:e.y+(s.y-e.y)/2},h=this._downX||0,j=this._downY||0,T=this._downScale,B=u.x-(-h+d.x)/T*l,L=u.y-(-j+d.y)/T*l;this.contents.setAll({x:B,y:L,scale:l})}}}}Object.defineProperty(w,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ZoomableContainer"});Object.defineProperty(w,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:m.classNames.concat([w.className])});class P extends m{constructor(){super(...arguments),Object.defineProperty(this,"homeButton",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(p.new(this._root,{width:35,height:35,themeTags:["home"]}))}),Object.defineProperty(this,"plusButton",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(p.new(this._root,{width:35,height:35,themeTags:["plus"]}))}),Object.defineProperty(this,"minusButton",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(p.new(this._root,{width:35,height:35,themeTags:["minus"]}))}),Object.defineProperty(this,"_disposer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_targetDisposer",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}_afterNew(){super._afterNew(),this.set("position","absolute"),this.set("layout",this._root.verticalLayout),this.addTag("zoomtools"),this.plusButton.setAll({icon:v.new(this._root,{themeTags:["icon"]}),layout:void 0}),this.minusButton.setAll({icon:v.new(this._root,{themeTags:["icon"]}),layout:void 0}),this.homeButton.setAll({icon:v.new(this._root,{themeTags:["icon"]}),layout:void 0})}_prepareChildren(){if(super._prepareChildren(),this.isDirty("target")){const i=this.get("target"),t=this._prevSettings.target;i&&(i instanceof w&&(this._targetDisposer=this.addDisposer(i.contents.on("scale",o=>{o==i.get("minZoomLevel")?this.minusButton.set("disabled",!0):this.minusButton.set("disabled",!1),o==i.get("maxZoomLevel")?this.plusButton.set("disabled",!0):this.plusButton.set("disabled",!1)})),this.root.events.once("frameended",()=>{i.get("scale")==i.get("minZoomLevel")&&this.minusButton.set("disabled",!0)})),this._disposer=new M([this.plusButton.events.on("click",()=>{i.zoomIn()}),this.minusButton.events.on("click",()=>{i.zoomOut()}),this.homeButton.events.on("click",()=>{i.goHome()})])),t&&(this._disposer&&this._disposer.dispose(),this._targetDisposer&&this._targetDisposer.dispose())}}}Object.defineProperty(P,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ZoomTools"});Object.defineProperty(P,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:m.classNames.concat([P.className])});export{p as B,_ as R,P as Z,w as a};

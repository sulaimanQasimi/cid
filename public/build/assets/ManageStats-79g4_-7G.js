import{r as d,S as v,j as e,L as A,$ as y}from"./app-DKKBgmCg.js";import{A as B}from"./app-layout-DvFC5FvT.js";import{B as j}from"./button-BdOwEqep.js";import{C as N,a as M,b as V,d as w}from"./card-DYBMoNes.js";import{I as D}from"./input-CHGftBA5.js";import{L as z}from"./label-Dw7T2BjB.js";import{T as $}from"./textarea-C8mAsHhP.js";import{u as F}from"./translate-DEQ7Kfra.js";import{a as O}from"./permission-guard-F4KMxvG3.js";import{S as P,a as T,b as H,c as R,d as S}from"./select-TGPedvUH.js";import{B as U}from"./badge-B1i48DNt.js";import{S as q}from"./x-D8D_IPLn.js";import{A as G}from"./arrow-left-BEHvUmuw.js";import{D as J}from"./database-DCmOE52L.js";import{B as K}from"./building-2-D3Vly2XY.js";import{T as Q}from"./triangle-alert-BzS5hhyn.js";import{S as W}from"./save-CvLwbTYq.js";import"./utils-CaFoPlFL.js";import"./index-CuxyEQ_g.js";import"./createLucideIcon-CnN_urJO.js";import"./index-hZbFuJWn.js";import"./index-CkgwL8Io.js";import"./index-DRCmvecH.js";import"./index-So6CGuKc.js";import"./avatar-CCKxpCEV.js";import"./file-text-Czrfr7-Y.js";import"./users-CvIQq5uM.js";import"./tag-7_ZYCSoz.js";import"./qr-code-0thgs0RQ.js";import"./chart-column-BgBYW86x.js";import"./map-pin-BJD42rlQ.js";import"./building-B5fR9vQA.js";import"./index-rCI1e_Z0.js";import"./check-BIGNLICC.js";function X(r){const c=new Map,u=[];return r.forEach(t=>{c.set(t.id,{...t,children:[]})}),r.forEach(t=>{const n=c.get(t.id);if(t.parent_id===null)u.push(n);else{const m=c.get(t.parent_id);m&&m.children.push(n)}}),u}const C=({item:r,level:c,statsData:u,onValueChange:t,onNotesChange:n})=>{const[m,p]=d.useState(!0),h=r.children&&r.children.length>0,x=!h,g=c*20,f=u[r.id]||{value:"",notes:""};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:`flex items-center py-3 border-b border-gray-100 dark:border-gray-800 ${h?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50":""}`,style:{paddingLeft:g},onClick:()=>h&&p(!m),children:[e.jsx("div",{className:"w-5 flex justify-center",children:h&&e.jsx("div",{className:"text-gray-400",children:m?"▼":"▶"})}),e.jsx("div",{className:"h-3 w-3 rounded-full mr-3 flex-shrink-0",style:{backgroundColor:r.color||r.category.color||"#e2e8f0"}}),e.jsx("div",{className:"font-medium flex-grow text-gray-900 dark:text-gray-100",children:r.label}),x&&e.jsx("div",{className:"flex-shrink-0 ml-4 w-32",children:e.jsx(D,{value:f.value,onChange:o=>t(r.id,o.target.value),onClick:o=>o.stopPropagation(),placeholder:"Value",className:"text-right h-8 text-sm"})})]}),x&&f.value.trim()&&e.jsx("div",{style:{paddingLeft:g+20},className:"py-2 border-b border-gray-100 dark:border-gray-800",children:e.jsx($,{value:f.notes,onChange:o=>n(r.id,o.target.value),placeholder:"Notes (optional)",className:"text-sm resize-none",rows:2})}),h&&m&&e.jsx("div",{children:r.children.map(o=>e.jsx(C,{item:o,level:c+1,statsData:u,onValueChange:t,onNotesChange:n},o.id))})]})};function Be({infoType:r,statItems:c,statCategories:u}){const{t}=F(),[n,m]=d.useState(()=>{const s={};return r.infoStats&&Array.isArray(r.infoStats)&&r.infoStats.forEach(i=>{const a=i.integer_value!==null?i.integer_value.toString():i.string_value||"";s[i.stat_category_item.id]={value:a,notes:i.notes||""}}),s}),[p,h]=d.useState(null),[x,g]=d.useState(!1),f=d.useMemo(()=>X(c),[c]),o=d.useMemo(()=>{if(!p)return f;const s=i=>i.reduce((a,l)=>{if(l.category.id===p)a.push(l);else if(l.children){const b=s(l.children);b.length>0&&a.push({...l,children:b})}return a},[]);return s(f)},[f,p]),_=d.useMemo(()=>Object.values(n).filter(s=>s.value.trim()!=="").length,[n]),k=d.useCallback((s,i)=>{m(a=>{var l;return{...a,[s]:{value:i,notes:((l=a[s])==null?void 0:l.notes)||""}}})},[]),I=d.useCallback((s,i)=>{m(a=>{var l;return{...a,[s]:{value:((l=a[s])==null?void 0:l.value)||"",notes:i}}})},[]),L=d.useCallback(async s=>{if(s.preventDefault(),x)return;const i=Object.entries(n).filter(([a,l])=>l.value.trim()!=="").map(([a,l])=>({stat_category_item_id:parseInt(a,10),value:l.value.trim(),notes:l.notes.trim()||null}));if(i.length===0){alert(t("info_types.manage_stats.no_stats_error"));return}g(!0);try{await new Promise((a,l)=>{v.put(route("info-types.stats.update",r.id),{stats:i},{preserveScroll:!0,onSuccess:()=>{alert(t("info_types.manage_stats.save_success")),v.reload({only:["infoType"]}),a()},onError:b=>{console.error("Validation errors:",b),alert(t("info_types.manage_stats.save_error")),l(new Error("Validation failed"))},onFinish:()=>{g(!1)}})})}catch(a){console.error("Submit error:",a),g(!1)}},[x,n,r.id,t]),E=[{title:t("info_types.page_title"),href:route("info-types.index")},{title:t("info_types.page_title"),href:route("info-types.index")},{title:r.name,href:route("info-types.show",r.id)},{title:t("info_types.manage_stats.page_title"),href:"#"}];return e.jsxs(B,{breadcrumbs:E,children:[e.jsx(A,{title:t("info_types.manage_stats.page_title",{name:r.name})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-6xl",children:[e.jsx("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 p-8 text-white shadow-2xl mb-8",children:e.jsxs("div",{className:"relative z-10 flex flex-col lg:flex-row lg:justify-between lg:items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"p-4 bg-white/20 backdrop-blur-md rounded-2xl",children:e.jsx(q,{className:"h-8 w-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl lg:text-4xl font-bold mb-2",children:t("info_types.manage_stats.page_title",{name:r.name})}),e.jsx("p",{className:"text-purple-100 text-lg",children:t("info_types.manage_stats.page_description")})]})]}),e.jsx(j,{asChild:!0,variant:"outline",size:"lg",className:"bg-white/20 backdrop-blur-md border-white/30 text-white hover:bg-white/30",children:e.jsxs(y,{href:route("info-types.show",r.id),className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),t("info_types.manage_stats.back_button")]})})]})}),e.jsx(O,{model:"info_type",children:e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs(N,{className:"shadow-xl border-0 rounded-2xl overflow-hidden",children:[e.jsx(M,{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white",children:e.jsxs(V,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-bold",children:t("info_types.manage_stats.form_title")}),e.jsx("div",{className:"text-purple-100 text-sm",children:t("info_types.manage_stats.form_description")})]})]}),e.jsxs(U,{variant:"secondary",className:"bg-white/20 text-white px-3 py-1",children:[_," ",t("info_types.manage_stats.selected_count")]})]})}),e.jsxs(w,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs(z,{htmlFor:"category-filter",className:"text-base font-medium flex items-center gap-2 text-purple-700 mb-2",children:[e.jsx(K,{className:"h-4 w-4"}),t("info_types.manage_stats.filter_by_category")]}),e.jsxs(P,{value:(p==null?void 0:p.toString())||"all",onValueChange:s=>h(s!=="all"?parseInt(s,10):null),children:[e.jsx(T,{className:"h-12 border-purple-200 focus:border-purple-500 focus:ring-purple-500/20",children:e.jsx(H,{placeholder:t("incidents.filters.all_categories")})}),e.jsxs(R,{children:[e.jsx(S,{value:"all",children:t("incidents.filters.all_categories")}),u.map(s=>e.jsx(S,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:s.color}}),s.label]})},s.id))]})]})]}),o.length>0?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-800 font-medium text-sm",children:[e.jsx("span",{children:t("info_types.manage_stats.category_items")}),e.jsx("span",{className:"w-32 text-right",children:t("info_types.manage_stats.value_column")})]}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:o.map(s=>e.jsx(C,{item:s,level:0,statsData:n,onValueChange:k,onNotesChange:I},s.id))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-purple-100 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-2",children:t("info_types.manage_stats.no_items")}),e.jsx("p",{className:"text-purple-600",children:t("info_types.manage_stats.no_items_description")})]})]})]}),e.jsx(N,{className:"shadow-xl border-0 rounded-2xl overflow-hidden",children:e.jsxs(w,{className:"p-6 bg-gradient-to-r from-purple-50 to-white flex justify-end gap-4",children:[e.jsx(j,{type:"button",variant:"outline",asChild:!0,className:"h-12 px-6 border-purple-300 text-purple-700 hover:bg-purple-100",children:e.jsx(y,{href:route("info-types.show",r.id),children:t("info_types.manage_stats.cancel_button")})}),e.jsx(j,{type:"submit",disabled:x||_===0,className:"h-12 px-8 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 disabled:opacity-50",children:x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),t("info_types.manage_stats.saving_button")]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),t("info_types.manage_stats.save_button")]})})]})})]})})]})]})}export{Be as default};

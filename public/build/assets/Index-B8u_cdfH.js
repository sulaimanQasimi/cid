import{r as m,j as e,L as q,$ as v,S as _}from"./app-C8epMaMb.js";import{B as G}from"./button-FVzS-Mc_.js";import{B as y}from"./badge-C06umBN0.js";import{C as J,d as K}from"./card-Dc9tAsBm.js";import{P as V}from"./pagination-3D1JHHLQ.js";import{T as W,a as X,b as S,c as h,d as Y,e as o}from"./table-BrG36Qiy.js";import{A as Z}from"./app-layout-DNPQfFHo.js";import{u as ee}from"./translate-BqC4VRD_.js";import{H as D}from"./header-rlYoeJi0.js";import{S as te}from"./SearchFilters-DSU2YmuC.js";import{S as se}from"./shield-B0cWtj1R.js";import{T as re}from"./trending-up-DRuoOgyF.js";import{T as ae}from"./triangle-alert-CZ4doazR.js";import{f as ie}from"./index-CaunA62S.js";import{F as ne}from"./file-text-Z2c-lbJ0.js";import{C as oe}from"./circle-alert-DrWbMJpA.js";import{A as F}from"./arrow-up-down-B_kL1C5J.js";import"./utils-COgRKxrs.js";import"./chevron-left-DTrTNk-3.js";import"./createLucideIcon-qDZgiwxw.js";import"./index-D7De99k_.js";import"./tslib.es6-CmEaCU22.js";import"./index-CIwqpUZw.js";import"./index-C7aTAxJs.js";import"./index-4m8-kKJv.js";import"./x-BrThxcKt.js";import"./index-Dx2PLc5V.js";import"./avatar-B4qs7XNX.js";import"./users-Bk2D86vC.js";import"./tag-DhnNX__m.js";import"./qr-code-DO8T_6St.js";import"./chart-column-KAbdIzDD.js";import"./map-pin-sI61wtIO.js";import"./database-DThzFDZb.js";import"./permission-guard-DCkeb0oR.js";import"./arrow-left-gn33pNEq.js";import"./plus-ZaAjpx9i.js";import"./select-BPRPaehj.js";import"./index-BCBCmRWV.js";import"./check-0f0Vyckc.js";import"./input-Bl2s9SJ5.js";import"./search-BHIAAvkd.js";import"./filter-x-vu7IJKlA.js";const le=[{title:"Dashboard",href:"/dashboard"},{title:"Incidents",href:route("incidents.index")}];function Ze({incidents:p,filters:i={},categories:P,canConfirm:ce}){const{t:s}=ee(),[C,N]=m.useState(i.search||""),[l,w]=m.useState(i.status||""),[c,T]=m.useState(i.category_id||""),[d,f]=m.useState(i.sort_field||"incident_date"),[n,u]=m.useState(i.sort_direction||"desc"),k=m.useRef(!0),g=m.useRef({status:i.status,categoryId:i.category_id,sortField:i.sort_field,sortDirection:i.sort_direction}),I=[{value:"all",label:s("incidents.filters.all_statuses")},{value:"reported",label:s("incidents.status.reported")},{value:"investigating",label:s("incidents.status.investigating")},{value:"resolved",label:s("incidents.status.resolved")},{value:"closed",label:s("incidents.status.closed")}],A=[{value:"all",label:s("incidents.filters.all_categories")},...P.map(t=>({value:t.id.toString(),label:t.name}))],B=[{value:"incident_date:desc",label:s("incidents.sort.date_newest")},{value:"incident_date:asc",label:s("incidents.sort.date_oldest")},{value:"title:asc",label:s("incidents.sort.title_asc")},{value:"title:desc",label:s("incidents.sort.title_desc")}],E=[{value:10,label:"10 per page"},{value:25,label:"25 per page"},{value:50,label:"50 per page"},{value:100,label:"100 per page"}],O=()=>{try{const t={search:C,status:l==="all"?"":l,category_id:c==="all"?"":c,sort_field:d,sort_direction:n},r=route("incidents.index"),a={preserveState:!0,replace:!0};setTimeout(()=>{_.get(r,t,a)},0)}catch(t){console.error("Error applying search:",t)}},R=()=>{try{const t={search:i.search||"",status:l==="all"?"":l,category_id:c==="all"?"":c,sort_field:d,sort_direction:n},r=route("incidents.index"),a={preserveState:!0,replace:!0};setTimeout(()=>{_.get(r,t,a)},0)}catch(t){console.error("Error applying filters:",t)}};m.useEffect(()=>{if(k.current){k.current=!1;return}const t=l!==g.current.status,r=c!==g.current.categoryId,a=d!==g.current.sortField,x=n!==g.current.sortDirection;(t||r||a||x)&&(g.current={status:l,categoryId:c,sortField:d,sortDirection:n},R())},[l,c,d,n]);const b=t=>{d===t?u(n==="asc"?"desc":"asc"):(f(t),u("asc"))},j=t=>d!==t?null:n==="asc"?e.jsx(F,{className:"ml-1 h-4 w-4 inline"}):e.jsx(F,{className:"ml-1 h-4 w-4 inline rotate-180"}),U=()=>{N(""),w("all"),T("all"),f("incident_date"),u("desc");try{const t={search:"",status:"",category_id:"",sort_field:"incident_date",sort_direction:"desc"},r=route("incidents.index"),a={preserveState:!0,replace:!0};setTimeout(()=>{_.get(r,t,a)},0)}catch(t){console.error("Error clearing filters:",t)}},$=t=>{t.preventDefault(),O()},H=t=>{w(t==="all"?"":t)},L=t=>{T(t==="all"?"":t)},z=t=>{const[r,a]=t.split(":");f(r),u(a)},M=()=>{u(n==="asc"?"desc":"asc")},Q=t=>{console.log("Per page changed to:",t)};return e.jsxs(Z,{breadcrumbs:le,children:[e.jsx(q,{title:s("incidents.page_title")}),e.jsxs("div",{className:"container px-0 py-6",children:[e.jsx(D,{title:s("incidents.page_title"),description:s("incidents.page_description"),icon:e.jsx(se,{className:"h-6 w-6"}),model:"incident",routeName:"incidents.create",buttonText:s("incidents.new_incident"),theme:"blue",buttonSize:"lg"}),e.jsx(te,{searchQuery:C,onSearchChange:N,onSearchSubmit:$,searchPlaceholder:s("incidents.search_placeholder"),filters:{type:l,category:c,sort:`${d}:${n}`,direction:n,per_page:10},onTypeChange:H,onCategoryChange:L,onDepartmentChange:()=>{},onSortChange:z,onDirectionChange:M,onPerPageChange:Q,onResetFilters:U,types:I,categories:A,departments:[],sortOptions:B,perPageOptions:E,title:s("incidents.search_filters"),description:s("incidents.find_and_filter"),className:"shadow-2xl bg-gradient-to-bl from-white dark:from-gray-800 to-blue-50/30 dark:to-blue-900/20 border-0  overflow-hidden"}),e.jsxs("div",{className:"mt-8 dark:bg-gray-800",children:[e.jsx(D,{title:s("incidents.table.title"),description:s("incidents.table.description"),icon:e.jsx(re,{className:"h-6 w-6"}),model:"incident",routeName:()=>"",buttonText:"",theme:"blue",showButton:!1}),e.jsx(J,{className:"shadow-lg",children:e.jsx(K,{className:"p-0",children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(S,{children:[e.jsxs(h,{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>b("title"),children:[s("incidents.table.title")," ",j("title")]}),e.jsxs(h,{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>b("incident_date"),children:[s("incidents.table.date")," ",j("incident_date")]}),e.jsx(h,{children:s("incidents.table.location")}),e.jsx(h,{children:s("incidents.table.category")}),e.jsx(h,{children:s("incidents.table.report")}),e.jsxs(h,{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>b("status"),children:[s("incidents.table.status")," ",j("status")]}),e.jsx(h,{children:s("incidents.table.confirmation")}),e.jsx(h,{children:s("common.actions")})]})}),e.jsx(Y,{children:p.data.length===0?e.jsx(S,{children:e.jsx(o,{colSpan:8,className:"h-32 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 text-muted-foreground",children:[e.jsx(ae,{className:"h-16 w-16"}),e.jsx("p",{className:"text-xl font-bold",children:s("incidents.no_incidents")}),e.jsx("p",{children:"No incident records found"})]})})}):p.data.map(t=>{var r,a,x;return e.jsxs(S,{children:[e.jsx(o,{children:e.jsx(v,{href:route("incidents.show",t.id),className:"font-medium hover:underline",children:t.title})}),e.jsx(o,{children:ie(new Date(t.incident_date),"PPP")}),e.jsxs(o,{children:[(r=t.district)==null?void 0:r.name,", ",(a=t.district_province)==null?void 0:a.name]}),e.jsx(o,{children:e.jsx(y,{variant:"outline",children:((x=t.category)==null?void 0:x.name)||s("incidents.unspecified")})}),e.jsx(o,{children:t.report?e.jsxs(v,{href:route("incident-reports.show",t.report.id),className:"flex items-center text-sm hover:underline",children:[e.jsx(ne,{className:"mr-1 h-4 w-4"}),t.report.report_number]}):e.jsx("span",{className:"text-muted-foreground",children:s("incidents.none")})}),e.jsx(o,{children:e.jsx(y,{variant:"outline",children:s(`incidents.status.${t.status}`)})}),e.jsxs(o,{children:[e.jsx(y,{variant:t.is_confirmed?"default":"outline",children:t.is_confirmed?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),s("incidents.confirmed")]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),s("incidents.unconfirmed")]})}),t.is_confirmed&&t.confirmer&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[s("incidents.confirmed_by"),": ",t.confirmer.name]})]}),e.jsx(o,{children:e.jsx(G,{variant:"ghost",size:"icon",asChild:!0,title:s("incidents.details"),children:e.jsx(v,{href:route("incidents.show",t.id),children:e.jsx(oe,{className:"h-4 w-4"})})})})]},t.id)})})]})})})]}),p.links&&p.links.length>0&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx("div",{className:"bg-gradient-to-l from-blue-50 to-white p-4 rounded-3xl shadow-2xl border border-blue-200",children:e.jsx(V,{links:p.links})})})]})]})}export{Ze as default};

import{r as l,S as _,j as e,L,$ as V}from"./app-YfAqnR7f.js";import{A}from"./app-layout-COLkdL-_.js";import{B as F}from"./button-CbisaLmO.js";import{C as v,a as M,b as D,d as j}from"./card-184hTnvA.js";import{I as T}from"./input-D9iYlYH4.js";import{L as z}from"./label-00ibPe3Z.js";import{T as H}from"./textarea-CQQgDuAT.js";import{u as O}from"./translate-BsBDFk7S.js";import{a as P}from"./permission-guard-C0O-U1KL.js";import{S as $,a as R,b as U,c as q,d as w}from"./select-51qNJE4q.js";import{B as G}from"./badge-B9st0FZz.js";import{H as J}from"./header-Bnz60xHa.js";import{F as K}from"./FooterButtons-hdIh5kAY.js";import{A as Q}from"./arrow-left-CvZHwRU4.js";import{S as W}from"./x-CUCKIsNl.js";import{D as X}from"./database-Dvh0JOEn.js";import{B as Y}from"./building-2-COm5HIqF.js";import{T as Z}from"./triangle-alert-Dle-CcDC.js";import"./utils-VXzwhqC1.js";import"./index-DK972n6K.js";import"./createLucideIcon-BKvLtUqt.js";import"./index-BC0tnl-N.js";import"./index-D9Wsk12K.js";import"./index-C2Xbs3d_.js";import"./index-CuGmnaN-.js";import"./avatar-Du_tf7pZ.js";import"./file-text-C1GLrAVP.js";import"./users-Dcm7r78U.js";import"./tag-Cw_E9OYd.js";import"./qr-code-BkqhmOCJ.js";import"./chart-column-caK4rhCu.js";import"./map-pin-Ci-gwDht.js";import"./building-Ce6TO76f.js";import"./index-ofrjtKms.js";import"./check-CxUgo-eI.js";import"./plus-BKIDhbTX.js";import"./save-B9x4CtFW.js";function ee(r){const c=new Map,h=[];return r.forEach(t=>{c.set(t.id,{...t,children:[]})}),r.forEach(t=>{const i=c.get(t.id);if(t.parent_id===null)h.push(i);else{const m=c.get(t.parent_id);m&&m.children.push(i)}}),h}const N=({item:r,level:c,statsData:h,onValueChange:t,onNotesChange:i})=>{const[m,u]=l.useState(!0),x=r.children&&r.children.length>0,g=!x,p=c*20,f=h[r.id]||{value:"",notes:""};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:`flex items-center py-3 border-b border-gray-100 dark:border-gray-800 ${x?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50":""}`,style:{paddingLeft:p},onClick:()=>x&&u(!m),children:[e.jsx("div",{className:"w-5 flex justify-center",children:x&&e.jsx("div",{className:"text-gray-400",children:m?"▼":"▶"})}),e.jsx("div",{className:"h-3 w-3 rounded-full mr-3 flex-shrink-0",style:{backgroundColor:r.color||r.category.color||"#e2e8f0"}}),e.jsx("div",{className:"font-medium flex-grow text-gray-900 dark:text-gray-100",children:r.label}),g&&e.jsx("div",{className:"flex-shrink-0 ml-4 w-32",children:e.jsx(T,{value:f.value,onChange:d=>t(r.id,d.target.value),onClick:d=>d.stopPropagation(),placeholder:"Value",className:"text-right h-8 text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-gray-200 dark:border-gray-700"})})]}),g&&f.value.trim()&&e.jsx("div",{style:{paddingLeft:p+20},className:"py-2 border-b border-gray-100 dark:border-gray-800",children:e.jsx(H,{value:f.notes,onChange:d=>i(r.id,d.target.value),placeholder:"Notes (optional)",className:"text-sm resize-none bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-gray-200 dark:border-gray-700",rows:2})}),x&&m&&e.jsx("div",{children:r.children.map(d=>e.jsx(N,{item:d,level:c+1,statsData:h,onValueChange:t,onNotesChange:i},d.id))})]})};function ze({infoType:r,statItems:c,statCategories:h}){const{t}=O(),[i,m]=l.useState(()=>{const s={};return r.infoStats&&Array.isArray(r.infoStats)&&r.infoStats.forEach(o=>{const a=o.integer_value!==null?o.integer_value.toString():o.string_value||"";s[o.stat_category_item.id]={value:a,notes:o.notes||""}}),s}),[u,x]=l.useState(null),[g,p]=l.useState(!1),f=l.useMemo(()=>ee(c),[c]),d=l.useMemo(()=>{if(!u)return f;const s=o=>o.reduce((a,n)=>{if(n.category.id===u)a.push(n);else if(n.children){const b=s(n.children);b.length>0&&a.push({...n,children:b})}return a},[]);return s(f)},[f,u]),y=l.useMemo(()=>Object.values(i).filter(s=>s.value.trim()!=="").length,[i]),k=l.useCallback((s,o)=>{m(a=>{var n;return{...a,[s]:{value:o,notes:((n=a[s])==null?void 0:n.notes)||""}}})},[]),S=l.useCallback((s,o)=>{m(a=>{var n;return{...a,[s]:{value:((n=a[s])==null?void 0:n.value)||"",notes:o}}})},[]),C=l.useCallback(async s=>{if(s.preventDefault(),g)return;const o=Object.entries(i).filter(([a,n])=>n.value.trim()!=="").map(([a,n])=>({stat_category_item_id:parseInt(a,10),value:n.value.trim(),notes:n.notes.trim()||null}));if(o.length===0){alert(t("info_types.manage_stats.no_stats_error"));return}p(!0);try{await new Promise((a,n)=>{_.put(route("info-types.stats.update",r.id),{stats:o},{preserveScroll:!0,onSuccess:()=>{alert(t("info_types.manage_stats.save_success")),_.reload({only:["infoType"]}),a()},onError:b=>{console.error("Validation errors:",b),alert(t("info_types.manage_stats.save_error")),n(new Error("Validation failed"))},onFinish:()=>{p(!1)}})})}catch(a){console.error("Submit error:",a),p(!1)}},[g,i,r.id,t]),B=l.useCallback(async()=>{if(g)return;const s=Object.entries(i).filter(([o,a])=>a.value.trim()!=="").map(([o,a])=>({stat_category_item_id:parseInt(o,10),value:a.value.trim(),notes:a.notes.trim()||null}));if(s.length===0){alert(t("info_types.manage_stats.no_stats_error"));return}p(!0);try{await new Promise((o,a)=>{_.put(route("info-types.stats.update",r.id),{stats:s},{preserveScroll:!0,onSuccess:()=>{alert(t("info_types.manage_stats.save_success")),_.reload({only:["infoType"]}),o()},onError:n=>{console.error("Validation errors:",n),alert(t("info_types.manage_stats.save_error")),a(new Error("Validation failed"))},onFinish:()=>{p(!1)}})})}catch(o){console.error("Submit error:",o),p(!1)}},[g,i,r.id,t]),E=l.useCallback(()=>{_.visit(route("info-types.show",r.id))},[r.id]),I=[{title:t("info_types.page_title"),href:route("info-types.index")},{title:t("info_types.page_title"),href:route("info-types.index")},{title:r.name,href:route("info-types.show",r.id)},{title:t("info_types.manage_stats.page_title"),href:"#"}];return e.jsxs(A,{breadcrumbs:I,children:[e.jsx(L,{title:t("info_types.manage_stats.page_title",{name:r.name})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-6xl",children:[e.jsx(J,{title:t("info_types.manage_stats.page_title",{name:r.name}),description:t("info_types.manage_stats.page_description"),icon:e.jsx(W,{className:"h-6 w-6 text-white"}),model:"info_type",routeName:route("info-types.stats",r.id),theme:"purple",buttonText:t("info_types.manage_stats.back_button"),showBackButton:!0,backRouteName:route("info-types.show",r.id),backButtonText:t("info_types.manage_stats.back_button"),showButton:!1,actionButtons:e.jsx(F,{asChild:!0,variant:"outline",size:"lg",className:"bg-white/20 backdrop-blur-md border-white/30 text-white hover:bg-white/30 shadow-2xl rounded-2xl px-6 py-3 text-lg font-semibold transition-all duration-300 hover:scale-105",children:e.jsxs(V,{href:route("info-types.show",r.id),className:"flex items-center gap-3",children:[e.jsx(Q,{className:"h-5 w-5"}),t("info_types.manage_stats.back_button")]})})}),e.jsx(P,{model:"info_type",children:e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs(v,{className:"shadow-xl border-0 rounded-2xl overflow-hidden bg-gradient-to-bl from-white dark:from-gray-800 to-purple-50/30 dark:to-purple-900/20",children:[e.jsx(M,{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white",children:e.jsxs(D,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-bold",children:t("info_types.manage_stats.form_title")}),e.jsx("div",{className:"text-purple-100 text-sm",children:t("info_types.manage_stats.form_description")})]})]}),e.jsxs(G,{variant:"secondary",className:"bg-white/20 text-white px-3 py-1",children:[y," ",t("info_types.manage_stats.selected_count")]})]})}),e.jsxs(j,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs(z,{htmlFor:"category-filter",className:"text-base font-medium flex items-center gap-2 text-purple-700 dark:text-purple-300 mb-2",children:[e.jsx(Y,{className:"h-4 w-4"}),t("info_types.manage_stats.filter_by_category")]}),e.jsxs($,{value:(u==null?void 0:u.toString())||"all",onValueChange:s=>x(s!=="all"?parseInt(s,10):null),children:[e.jsx(R,{className:"h-12 border-purple-200 dark:border-purple-700 focus:border-purple-500 dark:focus:border-purple-400 focus:ring-purple-500/20 dark:focus:ring-purple-400/20 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:e.jsx(U,{placeholder:t("incidents.filters.all_categories")})}),e.jsxs(q,{children:[e.jsx(w,{value:"all",children:t("incidents.filters.all_categories")}),h.map(s=>e.jsx(w,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:s.color}}),s.label]})},s.id))]})]})]}),d.length>0?e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-800 font-medium text-sm text-gray-900 dark:text-gray-100",children:[e.jsx("span",{children:t("info_types.manage_stats.category_items")}),e.jsx("span",{className:"w-32 text-right",children:t("info_types.manage_stats.value_column")})]}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:d.map(s=>e.jsx(N,{item:s,level:0,statsData:i,onValueChange:k,onNotesChange:S},s.id))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-purple-100 dark:bg-purple-800 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:e.jsx(Z,{className:"h-8 w-8 text-purple-400 dark:text-purple-300"})}),e.jsx("h3",{className:"text-lg font-semibold text-purple-800 dark:text-purple-200 mb-2",children:t("info_types.manage_stats.no_items")}),e.jsx("p",{className:"text-purple-600 dark:text-purple-400",children:t("info_types.manage_stats.no_items_description")})]})]})]}),e.jsx(v,{className:"shadow-xl border-0 rounded-2xl overflow-hidden",children:e.jsx(j,{className:"p-6 bg-gradient-to-r from-purple-50 dark:from-purple-900/20 to-white dark:to-gray-800",children:e.jsx(K,{onCancel:E,onSubmit:B,processing:g,cancelText:t("info_types.manage_stats.cancel_button"),submitText:t("info_types.manage_stats.save_button"),savingText:t("info_types.manage_stats.saving_button"),disabled:y===0})})})]})})]})]})}export{ze as default};

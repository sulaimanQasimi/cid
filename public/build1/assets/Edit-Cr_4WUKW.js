import{m as H,r as p,j as e,L as P,$ as k,a as K}from"./app-D9EKp-j0.js";import{B as x}from"./button-C_lbOJaF.js";import{C as u,a as j,b as g,c as v,d as f,e as M}from"./card-CJ646PJT.js";import{I as _}from"./input-CDqmtBAl.js";import{L as i}from"./label-DFSxdoGP.js";import{T as b}from"./textarea-5qnh3CSk.js";import{S,a as C,b as y,c as N,d}from"./select-Cs4X5igs.js";import{P as X}from"./page-header-i4y0N3hM.js";import{A as z}from"./app-layout-DLN7lXRp.js";import{I as c}from"./input-error-D4iMLVDS.js";import{T as G}from"./TreeViewStatSelector-OigsYxPS.js";import{A as J}from"./arrow-left-BcosiyJl.js";import{S as Q}from"./save-BAhoOAMe.js";import"./index-BdHtEbnZ.js";import"./index--GEwVf8d.js";import"./index-BYrHusN6.js";import"./index-CEWyTXIf.js";import"./createLucideIcon-2sT-PLZR.js";import"./index-BrNC6hno.js";import"./check-C5q72oI5.js";import"./x-CUky7n0R.js";import"./index-DQJiO2ZR.js";import"./avatar-DJGRXLRL.js";import"./app-logo-zrypSq5u.js";import"./app-logo-icon-BTqQbP9x.js";import"./tag-B3sBBI3s.js";import"./file-text-J_QMBZXb.js";import"./qr-code-Bvz4OGpj.js";function Fe({report:r,statItems:w,reportStats:E,statCategories:T}){const{data:l,setData:n,put:A,processing:F,errors:o}=H({report_number:r.report_number,report_date:r.report_date,security_level:r.security_level,details:r.details,action_taken:r.action_taken||"",recommendation:r.recommendation||"",report_status:r.report_status,source:r.source||""}),[R,D]=p.useState(()=>{const t={};return E.forEach(s=>{t[s.stat_category_item_id]={value:s.integer_value!==null?String(s.integer_value):s.string_value||"",notes:s.notes}}),t}),[W,Y]=p.useState(null),[m,I]=p.useState(null),L=[{title:"Dashboard",href:"/dashboard"},{title:"Incident Reports",href:route("incident-reports.index")},{title:r.report_number,href:route("incident-reports.show",r.id)},{title:"Edit",href:route("incident-reports.edit",r.id)}];function V(t){t.preventDefault();const s=Object.entries(R).map(([a,{value:h,notes:U}])=>({stat_category_item_id:parseInt(a),value:h,notes:U}));A(route("incident-reports.update",r.id),{onSuccess:()=>{var a;s.length>0?K.post(route("incident-reports.stats.batch-update",r.id),{stats:s},{headers:{"X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||"","Content-Type":"application/json",Accept:"application/json"}}).then(()=>{window.location.href=route("incident-reports.show",r.id)}).catch(h=>{console.error("Error updating stats:",h)}):window.location.href=route("incident-reports.show",r.id)}})}const O=m?w.filter(t=>t.category.id===m):w,$=T.map(t=>({id:t.id,label:t.label,color:t.color}));function q(t,s){D(a=>({...a,[t]:{...a[t]||{notes:null},value:s}}))}function B(t,s){D(a=>({...a,[t]:{...a[t]||{value:""},notes:s||null}}))}return e.jsxs(z,{breadcrumbs:L,children:[e.jsx(P,{title:`Edit Report - ${r.report_number}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsx(X,{title:`Edit Report ${r.report_number}`,description:"Modify this incident report",actions:e.jsx("div",{className:"flex space-x-2",children:e.jsx(x,{variant:"outline",asChild:!0,children:e.jsxs(k,{href:route("incident-reports.show",r.id),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Back to Report"]})})})}),e.jsx("form",{onSubmit:V,children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Report Information"}),e.jsx(v,{children:"Update the basic report information"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsx(i,{htmlFor:"report_number",children:"Report Number"}),e.jsx(_,{id:"report_number",value:l.report_number,onChange:t=>n("report_number",t.target.value),disabled:!0}),e.jsx(c,{message:o.report_number})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(i,{htmlFor:"report_date",children:"Report Date"}),e.jsx(_,{id:"report_date",type:"date",value:l.report_date,onChange:t=>n("report_date",t.target.value),required:!0}),e.jsx(c,{message:o.report_date})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(i,{htmlFor:"security_level",children:"Security Level"}),e.jsxs(S,{value:l.security_level,onValueChange:t=>n("security_level",t),children:[e.jsx(C,{id:"security_level",children:e.jsx(y,{placeholder:"Select security level"})}),e.jsxs(N,{children:[e.jsx(d,{value:"normal",children:"Normal"}),e.jsx(d,{value:"restricted",children:"Restricted"}),e.jsx(d,{value:"classified",children:"Classified"})]})]}),e.jsx(c,{message:o.security_level})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(i,{htmlFor:"report_status",children:"Status"}),e.jsxs(S,{value:l.report_status,onValueChange:t=>n("report_status",t),children:[e.jsx(C,{id:"report_status",children:e.jsx(y,{placeholder:"Select report status"})}),e.jsxs(N,{children:[e.jsx(d,{value:"submitted",children:"Submitted"}),e.jsx(d,{value:"reviewed",children:"Reviewed"}),e.jsx(d,{value:"approved",children:"Approved"})]})]}),e.jsx(c,{message:o.report_status})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(i,{htmlFor:"source",children:"Source (Optional)"}),e.jsx(_,{id:"source",value:l.source,onChange:t=>n("source",t.target.value),placeholder:"Information source"}),e.jsx(c,{message:o.source})]})]})]}),e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Report Details"}),e.jsx(v,{children:"Update the detailed information for this report"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsx(i,{htmlFor:"details",children:"Details"}),e.jsx(b,{id:"details",rows:5,value:l.details,onChange:t=>n("details",t.target.value),placeholder:"Enter the report details...",required:!0}),e.jsx(c,{message:o.details})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(i,{htmlFor:"action_taken",children:"Action Taken (Optional)"}),e.jsx(b,{id:"action_taken",rows:3,value:l.action_taken,onChange:t=>n("action_taken",t.target.value),placeholder:"Describe any actions taken..."}),e.jsx(c,{message:o.action_taken})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(i,{htmlFor:"recommendation",children:"Recommendation (Optional)"}),e.jsx(b,{id:"recommendation",rows:3,value:l.recommendation,onChange:t=>n("recommendation",t.target.value),placeholder:"Enter any recommendations..."}),e.jsx(c,{message:o.recommendation})]})]})]}),e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Statistical Data"}),e.jsx(v,{children:"Record statistical information related to this report"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(i,{htmlFor:"category-filter",children:"Filter by Category"}),e.jsxs(S,{value:(m==null?void 0:m.toString())||"all",onValueChange:t=>I(t!=="all"?parseInt(t):null),children:[e.jsx(C,{id:"category-filter",children:e.jsx(y,{placeholder:"All Categories"})}),e.jsxs(N,{children:[e.jsx(d,{value:"all",children:"All Categories"}),$.map(t=>e.jsx(d,{value:t.id.toString(),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-2 h-3 w-3 rounded-full",style:{backgroundColor:t.color}}),t.label]})},t.id))]})]})]}),e.jsx(G,{items:O,statsData:R,onValueChange:q,onNotesChange:B})]})]}),e.jsx(u,{children:e.jsxs(M,{className:"flex justify-end space-x-2 pt-6",children:[e.jsx(x,{variant:"outline",asChild:!0,type:"button",children:e.jsx(k,{href:route("incident-reports.show",r.id),children:"Cancel"})}),e.jsxs(x,{type:"submit",disabled:F,children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),F?"Saving...":"Save Changes"]})]})})]})})]})]})}export{Fe as default};
